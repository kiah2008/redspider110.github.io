<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Android,Camera,">










<meta name="description" content="Android Camera 开发相机应用相关 API2 介绍，以及使用示例。">
<meta name="keywords" content="Android,Camera">
<meta property="og:type" content="article">
<meta property="og:title" content="Android Camera API2 介绍">
<meta property="og:url" content="http://redspider110.github.io/2018/11/28/0109-android-camera-3-api2/index.html">
<meta property="og:site_name" content="Earth Guardian">
<meta property="og:description" content="Android Camera 开发相机应用相关 API2 介绍，以及使用示例。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://raw.githubusercontent.com/redspider110/blog-images/master/_images/0109-android-camera-3-api-ape-fwk-camera2-hidl.png">
<meta property="og:image" content="https://raw.githubusercontent.com/redspider110/blog-images/master/_images/0109-android-camera-3-api-ape-fwk-camera-old.png">
<meta property="og:image" content="https://raw.githubusercontent.com/redspider110/blog-images/master/_images/0109-android-camera-3-api-caemra2-class.png">
<meta property="og:image" content="https://raw.githubusercontent.com/redspider110/blog-images/master/_images/0109-android-camera-3-api-pipeline.png">
<meta property="og:image" content="https://raw.githubusercontent.com/redspider110/blog-images/master/_images/0109-android-camera-3-api-camera2-simple-usecase.png">
<meta property="og:image" content="https://raw.githubusercontent.com/redspider110/blog-images/master/_images/0109-android-camera-3-api-camera-pic-ratation.png">
<meta property="og:image" content="https://raw.githubusercontent.com/redspider110/blog-images/master/_images/0109-android-camera-3-api-camera-orientation.png">
<meta property="og:image" content="https://raw.githubusercontent.com/redspider110/blog-images/master/_images/0109-android-camera-3-api-class-flow.png">
<meta property="og:updated_time" content="2019-09-18T09:30:13.386Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android Camera API2 介绍">
<meta name="twitter:description" content="Android Camera 开发相机应用相关 API2 介绍，以及使用示例。">
<meta name="twitter:image" content="https://raw.githubusercontent.com/redspider110/blog-images/master/_images/0109-android-camera-3-api-ape-fwk-camera2-hidl.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://redspider110.github.io/2018/11/28/0109-android-camera-3-api2/">





  <title>Android Camera API2 介绍 | Earth Guardian</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?faa79b658398065f8158bf82b6221b6d";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Earth Guardian</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">You are not LATE!You are not EARLY!</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://redspider110.github.io/2018/11/28/0109-android-camera-3-api2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="redspider110">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Earth Guardian">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Android Camera API2 介绍</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-28T09:00:00+08:00">
                2018-11-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-eye"></i> 阅读次数
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><code>Android Camera</code> 开发相机应用相关 <code>API2</code> 介绍，以及使用示例。  </p>
<a id="more"></a>

<h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><h3 id="camera-各个版本"><a href="#camera-各个版本" class="headerlink" title="camera 各个版本"></a><code>camera</code> 各个版本</h3><ul>
<li><code>Camera API1</code><br><code>Android 4.4</code> 或更低版本设备上的应用级相机框架，通过 <code>android.hardware.Camera</code> 类提供。  </li>
<li><code>Camera API2</code><br><code>Android 5.0</code> 及更高版本设备上的应用级相机框架，通过 <code>android.hardware.camera2</code> 包提供。  </li>
<li><code>Camera HAL</code><br>由 <code>SoC</code> 供应商实现的相机模块层。该应用级公共框架基于 <code>Camera HAL</code> 构建而成。  </li>
<li><code>Camera HAL3.1</code><br>随 <code>Android 4.4</code> 发布的相机设备 <code>HAL</code> 版本。  </li>
<li><code>Camera HAL3.2</code><br>随 <code>Android 5.0</code> 发布的相机设备 <code>HAL</code> 版本。</li>
</ul>
<h3 id="Camera-API1"><a href="#Camera-API1" class="headerlink" title="Camera API1"></a><code>Camera API1</code></h3><p><code>Android 5.0</code> 已弃用 <code>Camera API1</code>，而且随着新平台开发的重点放在 <code>Camera API2</code> 上，<code>Camera API1</code> 会逐渐被淘汰。但是淘汰期限将会很长，而且在一段时间内新 <code>Android</code> 版本会继续支持 <code>Camera API1</code> 应用。具体来说，将继续为以下内容提供支持：  </p>
<ul>
<li>供应用使用的 <code>Camera API1</code> 接口；在 <code>Camera API1</code> 之上构建的相机应用应该像在运行早期 <code>Android</code> 版本的设备上一样工作  </li>
<li><code>Camera HAL</code> 版本，包括对 <code>Camera HAL1.0</code> 的支持  </li>
</ul>
<h3 id="Camera-API2"><a href="#Camera-API2" class="headerlink" title="Camera API2"></a><code>Camera API2</code></h3><p><code>Camera API2</code> 框架为应用提供更接近底层的相机控件，包括高效的零复制连拍/视频流以及曝光、增益、白平衡增益、颜色转换、去噪、锐化等方面的每帧控件。<br><code>Android 5.0</code> 及更高版本提供 <code>Camera API2</code>；但是运行 <code>Android 5.0</code> 及更高版本的设备可能并不支持所有 <code>Camera API2</code> 功能。应用可通过 <code>Camera API2</code> 接口查询 <code>android.info.supportedHardwareLevel</code> 属性。该属性会报告以下支持级别之一：  </p>
<ul>
<li><code>INFO_SUPPORTED_HARDWARE_LEVEL_LEGACY</code> 旧版<br>这些设备通过 <code>Camera API2</code> 接口为应用提供功能，而且这些功能与通过 <code>Camera API1</code> 接口提供给应用的功能大致相同。旧版框架代码在概念上将 <code>Camera API2</code> 调用转换为 <code>Camera API1</code> 调用；旧版设备不支持 <code>Camera API2</code> 功能，例如每帧控件。  </li>
<li><code>INFO_SUPPORTED_HARDWARE_LEVEL_LIMITED</code> 有限<br>这些设备支持部分（但不是全部）<code>Camera API2</code> 功能，并且必须使用 <code>Camera HAL 3.2</code> 或更高版本。  </li>
<li><code>INFO_SUPPORTED_HARDWARE_LEVEL_FULL</code> 全面<br>这些设备支持 <code>Camera API2</code> 的所有主要功能，并且必须使用 <code>Camera HAL 3.2</code> 或更高版本以及 <code>Android 5.0</code> 或更高版本。  </li>
<li><code>INFO_SUPPORTED_HARDWARE_LEVEL_3</code> 级别 3<br>这些设备支持 <code>YUV</code> 重新处理和 <code>RAW</code> 图片捕获，以及其他输出流配置。  </li>
<li><code>INFO_SUPPORTED_HARDWARE_LEVEL_EXTERNAL</code> 外部<br>这些设备类似于 <code>LIMITED</code> 设备，但有一些例外情况；例如某些传感器或镜头信息可能未被报告或具有较不稳定的帧速率。此级别用于外部相机（如 <code>USB</code> 网络摄像头）。  </li>
</ul>
<p>各个模式支持的功能级别 <code>LEGACY &lt; LIMITED &lt; FULL &lt; LEVEL_3</code> ；各项功能通过 <code>Camera API2</code> 接口中的 <code>android.request.availableCapabilities</code> 属性提供。<code>FULL</code> 设备需要具备 <code>MANUAL_SENSOR</code> 和 <code>MANUAL_POST_PROCESSING</code> 等功能。但即使是 <code>FULL</code> 设备，也并非必须实现 <code>RAW</code> 功能。 <code>LIMITED</code> 设备可以提供这些功能的任何子集，甚至可以不提供其中任何功能。但是必须始终定义 <code>BACKWARD_COMPATIBLE</code> 功能。  </p>
<p>设备支持的硬件级别及其支持的特定 <code>Camera API2</code> 功能采用以下功能标记的形式指明，<code>APP</code> 在使用时，在 <code>AndroidManifest.xml</code> 中通过 <code>uses-feature</code> 来声明使用的功能：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">android.hardware.camera.hardware_level.full</span><br><span class="line">android.hardware.camera.capability.raw</span><br><span class="line">android.hardware.camera.capability.manual_sensor</span><br><span class="line">android.hardware.camera.capability.manual_post_processing</span><br></pre></td></tr></table></figure>

<h3 id="HAL-新旧版本架构图"><a href="#HAL-新旧版本架构图" class="headerlink" title="HAL 新旧版本架构图"></a><code>HAL</code> 新旧版本架构图</h3><p>从 <code>Android 8.0</code> 开始，相机 <code>HAL</code> 实现了 <code>HIDL</code> 接口；而旧版本架构和新版本主要体现在 <code>HIDL</code> 上。  </p>
<p>基于 <code>HIDL</code> 的架构图<br><img src="https://raw.githubusercontent.com/redspider110/blog-images/master/_images/0109-android-camera-3-api-ape-fwk-camera2-hidl.png" alt="0109-android-camera-3-api-ape-fwk-camera2-hidl.png"></p>
<p>旧版架构图<br><img src="https://raw.githubusercontent.com/redspider110/blog-images/master/_images/0109-android-camera-3-api-ape-fwk-camera-old.png" alt="0109-android-camera-3-api-ape-fwk-camera-old.png"></p>
<blockquote>
<p><code>Camera</code> 各版本介绍详细参考：<a href="https://source.android.com/devices/camera" target="_blank" rel="noopener">Android Camera 架构</a> ， <a href="https://source.android.com/devices/camera/versioning" target="_blank" rel="noopener">Android Camera 版本支持</a>  </p>
</blockquote>
<h2 id="Camera2-类图结构"><a href="#Camera2-类图结构" class="headerlink" title="Camera2 类图结构"></a><code>Camera2</code> 类图结构</h2><p><img src="https://raw.githubusercontent.com/redspider110/blog-images/master/_images/0109-android-camera-3-api-caemra2-class.png" alt="0109-android-camera-3-api-caemra2-class.png"></p>
<h3 id="各个类功能简介"><a href="#各个类功能简介" class="headerlink" title="各个类功能简介"></a>各个类功能简介</h3><ul>
<li><code>CameraManager</code><br>相机设备管理员，用于检测相机设备，开启相机设备，获取相机设备支持的特性等等。 </li>
<li><code>CameraDevice</code><br>表示物理或逻辑摄像头，类似老版本中的 <code>Camera</code> 类，是对传感器相关功能的封装。  </li>
<li><code>CameraCaptureSession</code><br><code>Camera</code> 应用程序和 <code>CameraDevice</code> 硬件之间建立的一个会话类，用于从相机捕获图像或重新处理先前在同一会话中从相机捕获的图像，捕获到的图像输出到目标 <code>Surface</code> 中。为应用程序主要提供预览 <code>setRepeatingRequest</code> 和拍照 <code>capture</code> 功能。  </li>
<li><code>CameraMetadata</code><br>是一个数据结构，包含了 <code>CameraDevice</code> 控制命令和相关信息。<code>CameraMetadata</code> 用于查询 <code>CameraDevice</code> 属性、捕获结果、设置请求参数的基本键/值映射。<code>CameraMetadata</code> 的所有实例都是不可变的。  </li>
<li><code>CaptureRequest</code><br>表示从 <code>CameraDevice</code> 获取捕获数据的请求，包含对 <code>CameraDevice</code> 的参数设置，算法控制，输出缓冲区等等。  </li>
<li><code>CaptureResult</code><br>表示从 <code>CameraDevice</code> 获取到数据的结果子集；包含捕获硬件（传感器，镜头，闪存），控制算法和输出缓冲区的最终配置等的子集；<code>CaptureResult</code> 对象实例是不可变的。  </li>
<li><code>CameraCharacteristics</code><br>用来描述 <code>CameraDevice</code> 设备的属性，这些属性是不可修改的，设备出厂时提供的；可以通过 <code>CameraManager.getCameraCharacteristics(String cameraID)</code> 来查询当前设备支持哪些属性。  </li>
</ul>
<h3 id="基本结构"><a href="#基本结构" class="headerlink" title="基本结构"></a>基本结构</h3><p><img src="https://raw.githubusercontent.com/redspider110/blog-images/master/_images/0109-android-camera-3-api-pipeline.png" alt="0109-android-camera-3-api-pipeline.png"></p>
<p>在 <code>Camera2</code> 的架构中，<code>APP</code> 和 <code>CameraDevice</code> 之间通过 <code>Pipeline</code> 管道来连接。  </p>
<ul>
<li><code>CameraCaptureSession</code> 充当管道的功能  </li>
<li><code>APP</code> 向 <code>CameraDevice</code> 发送 <code>CaptureRequest</code>  </li>
<li><code>CameraDevices</code> 收到请求后返回对应数据到对应的 <code>Surface</code> ：通常 <code>TextureView</code> 用来预览，<code>ImageReader</code> 用来拍照保存  </li>
</ul>
<h3 id="简化使用流程图"><a href="#简化使用流程图" class="headerlink" title="简化使用流程图"></a>简化使用流程图</h3><p><img src="https://raw.githubusercontent.com/redspider110/blog-images/master/_images/0109-android-camera-3-api-camera2-simple-usecase.png" alt="0109-android-camera-3-api-camera2-simple-usecase.png"></p>
<h2 id="CameraManager"><a href="#CameraManager" class="headerlink" title="CameraManager"></a><code>CameraManager</code></h2><p><code>CameraManager</code> 相机设备管理员，用于检测相机设备，开启相机设备，获取相机设备支持的特性等等。  </p>
<h3 id="API-方法"><a href="#API-方法" class="headerlink" title="API 方法"></a><code>API</code> 方法</h3><p><code>CameraManager</code> 提供的 <code>API</code> 非常简单，围绕着类的主要功能：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">CameraManager</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> USE_CALLING_UID = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unused"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> API_VERSION_1 = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> API_VERSION_2 = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CAMERA_TYPE_BACKWARD_COMPATIBLE = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CAMERA_TYPE_ALL = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;String&gt; mDeviceIdList;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Context mContext;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object mLock = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CameraManager</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span>(mLock) &#123;</span><br><span class="line">            mContext = context;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取指定设备的属性</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CameraCharacteristics <span class="title">getCameraCharacteristics</span> <span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        String cameraId)</span></span>&#123;...&#125;</span><br><span class="line">    <span class="comment">// 获取当前系统中的设备 ID 数组</span></span><br><span class="line">    <span class="keyword">public</span> String[] getCameraIdList() <span class="keyword">throws</span> CameraAccessException &#123;</span><br><span class="line">        <span class="keyword">return</span> CameraManagerGlobal.get().getCameraIdList();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 开启指定 ID 的相机设备</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">openCamera</span><span class="params">(@NonNull String cameraId,</span></span></span><br><span class="line"><span class="function"><span class="params">        @NonNull <span class="keyword">final</span> CameraDevice.StateCallback callback, </span></span></span><br><span class="line"><span class="function"><span class="params">        @Nullable Handler handler)</span> <span class="keyword">throws</span> CameraAccessException </span>&#123;</span><br><span class="line">        openCameraForUid(cameraId, callback, handler, USE_CALLING_UID);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 使用并发器开启相机设备</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">openCamera</span> <span class="params">(String cameraId,  Executor executor, </span></span></span><br><span class="line"><span class="function"><span class="params">        CameraDevice.StateCallback callback)</span></span>&#123;...&#125;</span><br><span class="line">    <span class="comment">// 注册 AvailabilityCallback</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerAvailabilityCallback</span> <span class="params">(Executor executor, </span></span></span><br><span class="line"><span class="function"><span class="params">        CameraManager.AvailabilityCallback callback)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerAvailabilityCallback</span> <span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        CameraManager.AvailabilityCallback callback, Handler handler)</span></span>&#123;...&#125;</span><br><span class="line">    <span class="comment">// 取消 AvailabilityCallback</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unregisterAvailabilityCallback</span> <span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        CameraManager.AvailabilityCallback callback)</span></span>&#123;...&#125;</span><br><span class="line">    <span class="comment">// 注册 TorchCallback</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerTorchCallback</span> <span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        CameraManager.TorchCallback callback, Handler handler)</span></span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerTorchCallback</span> <span class="params">(Executor executor, </span></span></span><br><span class="line"><span class="function"><span class="params">        CameraManager.TorchCallback callback)</span></span>&#123;...&#125;</span><br><span class="line">    <span class="comment">// 取消 TorchCallback</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unregisterTorchCallback</span> <span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        CameraManager.TorchCallback callback)</span></span>&#123;...&#125;</span><br><span class="line">    <span class="comment">// 指定 ID 相机设备，设置手电筒模式</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTorchMode</span><span class="params">(@NonNull String cameraId, <span class="keyword">boolean</span> enabled)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> CameraAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (CameraManagerGlobal.sCameraServiceDisabled) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"..."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        CameraManagerGlobal.get().setTorchMode(cameraId, enabled);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="AvailabilityCallback-回调"><a href="#AvailabilityCallback-回调" class="headerlink" title="AvailabilityCallback 回调"></a><code>AvailabilityCallback</code> 回调</h3><p><code>CameraManager.AvailabilityCallback</code> 表示相机设备开启后状态，变为有效或无效状态。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AvailabilityCallback</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCameraAvailable</span><span class="params">(@NonNull String cameraId)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCameraUnavailable</span><span class="params">(@NonNull String cameraId)</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="TorchCallback-回调"><a href="#TorchCallback-回调" class="headerlink" title="TorchCallback 回调"></a><code>TorchCallback</code> 回调</h3><p><code>CameraManager.TorchCallback</code> 闪光灯用作手电筒的回调接口，表示闪光灯处于开启手电筒、关闭、或者无效状态。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">TorchCallback</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTorchModeUnavailable</span><span class="params">(@NonNull String cameraId)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTorchModeChanged</span><span class="params">(@NonNull String cameraId, </span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">boolean</span> enabled)</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="CameraDevice"><a href="#CameraDevice" class="headerlink" title="CameraDevice"></a><code>CameraDevice</code></h2><p><code>CameraDevice</code> 表示物理或逻辑摄像头，类似老版本中的 <code>Camera</code> 类，是对传感器相关功能的封装。使用前需要注意：  </p>
<ul>
<li>权限<br><code>CameraDevice</code> 使用前需要申请权限 <code>&lt;uses-permission android:name=&quot;android.permission.CAMERA&quot; /&gt;</code> 。  </li>
<li>支持功能的级别<br>通过 <code>CameraCharacteristics.INFO_SUPPORTED_HARDWARE_LEVEL</code> 查看当前手机平台支持的功能级别。如果支持 <code>LEGACY</code> 级别，则摄像机设备以向后兼容模式运行，并且支持最小的 <code>Camera2 API</code> ；如果支持 <code>LIMITED</code> 级别，则 <code>Camera2 API</code> 是和旧版 <code>Camera API</code> 大致相同的功能集，但界面更清晰效率更高；如果支持 <code>EXTERNAL</code> 级别，则该设备是可移动摄像头，提供与 <code>LIMITED</code> 级别相似但略少的功能；如果支持 <code>FULL, LEVEL3</code> 级别，<code>API</code> 将提供显着改进的功能。如果开发的 <code>Camera</code> 应用程序需要一个完整级别的设备才能正常运行，需要请在清单中声明 <code>android.hardware.camera.level.full</code> 功能。  </li>
</ul>
<h3 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h3><p><code>CameraDevice</code> 中控制模板常量：  </p>
<ul>
<li><code>TEMPLATE_MANUAL</code><br>手动控制模板，禁用所有的自动控制 <code>3A</code> 算法。  </li>
<li><code>TEMPLATE_PREVIEW</code><br>创建适合相机预览的窗口，高帧率优于高质量的后期处理。  </li>
<li><code>TEMPLATE_RECORD</code><br>创建适合录像的请求，使用稳定的帧率。  </li>
<li><code>TEMPLATE_STILL_CAPTURE</code><br>创建适合拍照的请求，优先考虑帧速率的图像质量。  </li>
<li><code>TEMPLATE_VIDEO_SNAPSHOT</code><br>创建录像时快照的请求，在不中断录像的前提下最大化图像质量。  </li>
<li><code>TEMPLATE_ZERO_SHUTTER_LAG</code><br>创建 <code>ZSL</code> 零延时拍照请求，在不影响帧率的前提下最大化图像质量，并开启 <code>3A</code> 算法。  </li>
</ul>
<h3 id="API-方法-1"><a href="#API-方法-1" class="headerlink" title="API 方法"></a><code>API</code> 方法</h3><p><code>CameraDevice</code> 中 <code>API</code> 简介：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">CameraDevice</span> <span class="keyword">implements</span> <span class="title">AutoCloseable</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 关闭设备</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">close</span> <span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// 使用指定模板创建请求</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> CaptureRequest.<span class="function">Builder <span class="title">createCaptureRequest</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        @RequestTemplate <span class="keyword">int</span> templateType)</span> <span class="keyword">throws</span> CameraAccessException</span>;</span><br><span class="line">    <span class="comment">// 使用指定模板创建请求，同时指定物理摄像头 ID 集</span></span><br><span class="line">    <span class="keyword">public</span> CaptureRequest.<span class="function">Builder <span class="title">createCaptureRequest</span> <span class="params">(<span class="keyword">int</span> templateType, </span></span></span><br><span class="line"><span class="function"><span class="params">        Set&lt;String&gt; physicalCameraIdSet)</span></span>&#123;...&#125;</span><br><span class="line">    <span class="comment">// 根据指定会话配置文件，创建会话</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createCaptureSession</span> <span class="params">(SessionConfiguration config)</span></span>&#123;...&#125;</span><br><span class="line">    <span class="comment">// 给定输出列表，创建会话；API 文档中有非常详细的匹配图</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">createCaptureSession</span> <span class="params">(List&lt;Surface&gt; outputs, </span></span></span><br><span class="line"><span class="function"><span class="params">        CameraCaptureSession.StateCallback callback,  Handler handler)</span></span>;</span><br><span class="line">    <span class="comment">// 根据给定输出配置文件列表，创建会话</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">createCaptureSessionByOutputConfigurations</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        List&lt;OutputConfiguration&gt; outputConfigurations, </span></span></span><br><span class="line"><span class="function"><span class="params">        CameraCaptureSession.StateCallback callback, Handler handler)</span>；</span></span><br><span class="line"><span class="function">    <span class="comment">// 给定输出列表，创建高速会话</span></span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">createConstrainedHighSpeedCaptureSession</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        List&lt;Surface&gt; outputs, </span></span></span><br><span class="line"><span class="function"><span class="params">        CameraCaptureSession.StateCallback callback, Handler handler)</span></span>;</span><br><span class="line">    <span class="comment">// 创建重新处理请求</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> CaptureRequest.<span class="function">Builder <span class="title">createReprocessCaptureRequest</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        TotalCaptureResult inputResult)</span></span>;</span><br><span class="line">    <span class="comment">// 创建重复处理会话；API 文档中有详细匹配图</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">createReprocessableCaptureSession</span> <span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        InputConfiguration inputConfig, List&lt;Surface&gt; outputs, </span></span></span><br><span class="line"><span class="function"><span class="params">        CameraCaptureSession.StateCallback callback, Handler handler)</span></span>;</span><br><span class="line">    <span class="comment">// 根据配置文件创建重复处理会话</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">createReprocessableCaptureSessionByConfigurations</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        InputConfiguration inputConfig, List&lt;OutputConfiguration&gt; outputs, </span></span></span><br><span class="line"><span class="function"><span class="params">        CameraCaptureSession.StateCallback callback, Handler handler)</span></span>;</span><br><span class="line">    <span class="comment">// 获取设备的 ID</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">getId</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="StateCallback-回调"><a href="#StateCallback-回调" class="headerlink" title="StateCallback 回调"></a><code>StateCallback</code> 回调</h3><p><code>CameraDevice.StateCallback</code> 状态回调接口，在 <code>CameraManager.open</code> 打开摄像头时，必须提供该回调接口；表示当前 <code>CameraDevice</code> 的状态。<br><code>CameraDevice.StateCallback</code> 中设备错误常量，在 <code>onError()</code> 方法中返回：  </p>
<ul>
<li><code>ERROR_CAMERA_DEVICE</code> ：开启设备时遇到致命错误  </li>
<li><code>ERROR_CAMERA_DISABLED</code> ：由于设备策略，无法开启摄像头  </li>
<li><code>ERROR_CAMERA_IN_USE</code> ：当前开启设备正在被使用  </li>
<li><code>ERROR_CAMERA_SERVICE</code> ：<code>CameraService</code> 致命错误  </li>
<li><code>ERROR_MAX_CAMERAS_IN_USE</code> ：开启的设备已经达到最大数量  </li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">StateCallback</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 当 CameraDevice.close() 调用时会触发；如果设备已经关闭，</span></span><br><span class="line">    <span class="comment">// 后续再次调用 CameraDevice 相关方法会抛出异常 IllegalStateException</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClosed</span> <span class="params">(CameraDevice camera)</span></span>&#123;...&#125;</span><br><span class="line">    <span class="comment">// 表示设备不能再被使用；再次访问会抛出 CameraAccessException</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">onDisconnected</span> <span class="params">(CameraDevice camera)</span></span>&#123;...&#125;</span><br><span class="line">    <span class="comment">// 开启设备失败；再次访问抛出 CameraAccessException，并给出 error</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">onError</span> <span class="params">(CameraDevice camera, <span class="keyword">int</span> error)</span></span>;</span><br><span class="line">    <span class="comment">// 设备被正常打开</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">onOpened</span> <span class="params">(CameraDevice camera)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="CameraCaptureSession"><a href="#CameraCaptureSession" class="headerlink" title="CameraCaptureSession"></a><code>CameraCaptureSession</code></h2><p>抽象类；<code>Camera</code> 应用程序和 <code>CameraDevice</code> 硬件之间建立的一个会话类，用于从相机捕获图像或重新处理先前在同一会话中从相机捕获的图像，捕获到的图像输出到目标 <code>Surface</code> 中。为应用程序主要提供预览 <code>setRepeatingRequest</code> 和拍照 <code>capture</code> 功能。  </p>
<p><code>CameraCaptureSession</code> 创建非常耗时，可能需要几百毫秒，因为它需要配置摄像机设备的内部管道并分配内存缓冲区以将图像发送到所需目标，因此需要异步去完成。在 <code>CameraDevice</code> 中有两种方式创建：  </p>
<ul>
<li><code>createCaptureSession</code>  </li>
<li><code>createReprocessableCaptureSession</code> ：可以重新处理先前在同一会话中从摄像机捕获的图像  </li>
</ul>
<h3 id="API-方法-2"><a href="#API-方法-2" class="headerlink" title="API 方法"></a><code>API</code> 方法</h3><p><code>CameraCaptureSession</code> 中 <code>API</code> 简介：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">CameraCaptureSession</span> <span class="keyword">implements</span> <span class="title">AutoCloseable</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 取消所有的数据捕获</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">abortCaptures</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// 拍照：向 CameraDevice 发出拍照请求；返回序列号  </span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">capture</span><span class="params">(CaptureRequest request, </span></span></span><br><span class="line"><span class="function"><span class="params">        CameraCaptureSession.CaptureCallback listener, Handler handler)</span></span>;</span><br><span class="line">    <span class="comment">// 提交一个顺序捕获的列表</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">captureBurst</span><span class="params">(List&lt;CaptureRequest&gt; requests, </span></span></span><br><span class="line"><span class="function"><span class="params">        CameraCaptureSession.CaptureCallback listener, Handler handler)</span></span>;</span><br><span class="line">    <span class="comment">// 提交顺序捕获列表，给定并发器</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">captureBurstRequests</span><span class="params">(List&lt;CaptureRequest&gt; requests, </span></span></span><br><span class="line"><span class="function"><span class="params">        Executor executor, CameraCaptureSession.CaptureCallback listener)</span></span></span><br><span class="line"><span class="function">        </span>&#123;...&#125;</span><br><span class="line">    <span class="comment">// 给定并发器，提交一个数据捕获请求</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">captureSingleRequest</span><span class="params">(CaptureRequest request, Executor executor, </span></span></span><br><span class="line"><span class="function"><span class="params">        CameraCaptureSession.CaptureCallback listener)</span></span>&#123;...&#125;</span><br><span class="line">    <span class="comment">// 关闭 CameraCaptureSession</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// 最终确定的输出配置</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">finalizeOutputConfigurations</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        List&lt;OutputConfiguration&gt; outputConfigs)</span></span>;</span><br><span class="line">    <span class="comment">// 获取 CameraDevice</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> CameraDevice <span class="title">getDevice</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// 获取输入 Surface</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> Surface <span class="title">getInputSurface</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// 是否可以从新处理先前获取的图像</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">boolean</span> <span class="title">isReprocessable</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// 为输出 Surface 分配缓冲区</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">(Surface surface)</span></span>;</span><br><span class="line">    <span class="comment">// 预览：设置预览请求列表</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">setRepeatingBurst</span><span class="params">(List&lt;CaptureRequest&gt; requests,</span></span></span><br><span class="line"><span class="function"><span class="params">        CameraCaptureSession.CaptureCallback listener, Handler handler)</span></span>;</span><br><span class="line">    <span class="comment">// 预览：使用指定并发器设置预览请求列表</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">setRepeatingBurstRequests</span><span class="params">(List&lt;CaptureRequest&gt; requests, </span></span></span><br><span class="line"><span class="function"><span class="params">        Executor executor, CameraCaptureSession.CaptureCallback listener)</span></span></span><br><span class="line"><span class="function">        </span>&#123;...&#125;</span><br><span class="line">    <span class="comment">// 预览：设置一个预览请求</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">setRepeatingRequest</span><span class="params">(CaptureRequest request, </span></span></span><br><span class="line"><span class="function"><span class="params">        CameraCaptureSession.CaptureCallback listener, Handler handler)</span></span>;</span><br><span class="line">    <span class="comment">// 预览：使用指定并发器设置预览请求</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">setSingleRepeatingRequest</span><span class="params">(CaptureRequest request, </span></span></span><br><span class="line"><span class="function"><span class="params">        Executor executor, CameraCaptureSession.CaptureCallback listener)</span></span></span><br><span class="line"><span class="function">        </span>&#123;...&#125;</span><br><span class="line">    <span class="comment">// 停止预览</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">stopRepeating</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// 更新输出配置</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateOutputConfiguration</span><span class="params">(OutputConfiguration config)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="StateCallback-回调-1"><a href="#StateCallback-回调-1" class="headerlink" title="StateCallback 回调"></a><code>StateCallback</code> 回调</h4><p><code>CameraCaptureSession.StateCallback</code> 状态回调接口，表示会话创建成功后或者会话有内容变化时会触发回调。<code>CameraCaptureSession</code> 创建成功后处于活动状态，直到摄像机设备创建新会话或关闭摄像机设备。创建成功后会触发 <code>onConfigured</code> 回调；如果无法完成配置，则会触发 <code>onConfigureFailed</code>，并且会话不会变为活动状态。新会话创建成功，则会关闭先前的会话，并会触发其 <code>onClosed</code> 回调。如果在会话关闭后调用，则所有会话方法都将抛出 <code>IllegalStateException</code>。<br>回调接口有如下几个方法，其中 <code>onConfigured, onConfigureFailed</code> 是抽象类，需要在子类中实现：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">StateCallback</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 开始处理捕获请求时触发  </span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onActive</span><span class="params">(CameraCaptureSession session)</span></span>;</span><br><span class="line">    <span class="comment">// 当 CameraDevice 输入捕获队列为空并准备接受下一个请求时触发</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onCaptureQueueEmpty</span><span class="params">(CameraCaptureSession session)</span></span>;</span><br><span class="line">    <span class="comment">// 当 CameraCaptureSession 关闭时触发；</span></span><br><span class="line">    <span class="comment">//如果还有方法被调用将会抛出 IllegalStateException</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onClosed</span><span class="params">(CameraCaptureSession session)</span></span>;</span><br><span class="line">    <span class="comment">// 抽象方法，当请求失败时触发；之后 CameraCaptureSession 会被认为是关闭的</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">onConfigureFailed</span><span class="params">(CameraCaptureSession session)</span></span>;</span><br><span class="line">    <span class="comment">// 当摄像机设备完成自身配置时触发，CameraCaptureSession 可以开始处理捕获请求</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">onConfigured</span><span class="params">(CameraCaptureSession session)</span></span>;</span><br><span class="line">    <span class="comment">// 每次不再有要处理的捕获请求时触发  </span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onReady</span><span class="params">(CameraCaptureSession session)</span></span>;</span><br><span class="line">    <span class="comment">// 当输出 Surface 的缓冲区预分配完成时触发</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onSurfacePrepared</span><span class="params">(CameraCaptureSession session, Surface surface)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="CaptureCallback-回调"><a href="#CaptureCallback-回调" class="headerlink" title="CaptureCallback 回调"></a><code>CaptureCallback</code> 回调</h3><p><code>CameraCaptureSession.CaptureCallback</code> 捕获回调接口，表示 <code>CameraDevice</code> 在接收到数据更新时的回调：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">CaptureCallback</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 当单个捕获到的 Buffer 数据无法发送到 Surface 时触发  </span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onCaptureBufferLost</span><span class="params">(CameraCaptureSession session, </span></span></span><br><span class="line"><span class="function"><span class="params">        CaptureRequest request, Surface target, <span class="keyword">long</span> frameNumber)</span></span>;</span><br><span class="line">    <span class="comment">// 图像捕获完成并且所有数据可用时触发  </span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onCaptureCompleted</span><span class="params">(CameraCaptureSession session, </span></span></span><br><span class="line"><span class="function"><span class="params">        CaptureRequest request, TotalCaptureResult result)</span></span>;</span><br><span class="line">    <span class="comment">// 当 CameraDevice 无法为请求生成 CaptureResult 时触发  </span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onCaptureFailed</span><span class="params">(CameraCaptureSession session, </span></span></span><br><span class="line"><span class="function"><span class="params">        CaptureRequest request, CaptureFailure failure)</span></span>;</span><br><span class="line">    <span class="comment">// 这里的结果是完整结果的一部分，每次捕获可能会多次触发</span></span><br><span class="line">    <span class="comment">// 每个结果只可能出现在某一次中，而最终整体的结果在 onCaptureCompleted 中</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onCaptureProgressed</span><span class="params">(CameraCaptureSession session, </span></span></span><br><span class="line"><span class="function"><span class="params">        CaptureRequest request, CaptureResult partialResult)</span></span>;</span><br><span class="line">    <span class="comment">// 中止捕获时触发  </span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onCaptureSequenceAborted</span><span class="params">(CameraCaptureSession session,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">int</span> sequenceId)</span></span>;</span><br><span class="line">    <span class="comment">// 捕获序列已经完成，并且结果已经返回时触发  </span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onCaptureSequenceCompleted</span><span class="params">(CameraCaptureSession session, </span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">int</span> sequenceId, <span class="keyword">long</span> frameNumber)</span></span>;</span><br><span class="line">    <span class="comment">// 当 CameraDevice 开始捕获图像时触发  </span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onCaptureStarted</span><span class="params">(CameraCaptureSession session, </span></span></span><br><span class="line"><span class="function"><span class="params">        CaptureRequest request, <span class="keyword">long</span> timestamp, <span class="keyword">long</span> frameNumber)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="CameraConstrainedHighSpeedCaptureSession"><a href="#CameraConstrainedHighSpeedCaptureSession" class="headerlink" title="CameraConstrainedHighSpeedCaptureSession"></a><code>CameraConstrainedHighSpeedCaptureSession</code></h2><p>抽象类，继承 <code>CameraCaptureSession</code> ，表示高速捕获会话，支持大于等于 120 帧/秒的录像。只有一个公共并且是抽象的方法 <code>createHighSpeedRequestList</code> ，表示创建高速请求列表。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">CameraConstrainedHighSpeedCaptureSession</span> </span></span><br><span class="line"><span class="class">        <span class="keyword">extends</span> <span class="title">CameraCaptureSession</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> List&lt;CaptureRequest&gt; <span class="title">createHighSpeedRequestList</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            @NonNull CaptureRequest request)</span> <span class="keyword">throws</span> CameraAccessException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="CaptureFailure"><a href="#CaptureFailure" class="headerlink" title="CaptureFailure"></a><code>CaptureFailure</code></h2><p><code>CaptureFailure</code> 类表示拍照失败，包含了失败的具体信息；在 <code>CameraCaptureSession.CaptureCallback</code> 回调接口的 <code>onCaptureFailed</code> 中返回该类。  </p>
<h3 id="常量-1"><a href="#常量-1" class="headerlink" title="常量"></a>常量</h3><p><code>CaptureFailure</code> 中包含两个表示失败原因的常量：  </p>
<ul>
<li><code>REASON_ERROR</code> ：<code>framework</code> 中出现的错误，导致当前帧丢弃了 <code>CaptureResult</code>  </li>
<li><code>REASON_FLUSHED</code> ：因为调用了 <code>CameraCaptureSession.abortCaptures()</code> 导致的捕获失败  </li>
</ul>
<h3 id="API-方法-3"><a href="#API-方法-3" class="headerlink" title="API 方法"></a><code>API</code> 方法</h3><p><code>CaptureFailure</code> 中 <code>API</code> 简介：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CaptureFailure</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> REASON_ERROR = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> REASON_FLUSHED = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CaptureRequest mRequest;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> mReason;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> mDropped;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> mSequenceId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> mFrameNumber;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CaptureFailure</span><span class="params">(CaptureRequest request, <span class="keyword">int</span> reason,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">boolean</span> dropped, <span class="keyword">int</span> sequenceId, <span class="keyword">long</span> frameNumber)</span> </span>&#123;</span><br><span class="line">        mRequest = request;</span><br><span class="line">        mReason = reason;</span><br><span class="line">        mDropped = dropped;</span><br><span class="line">        mSequenceId = sequenceId;</span><br><span class="line">        mFrameNumber = frameNumber;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> CaptureRequest <span class="title">getRequest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mRequest;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获取帧编号</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getFrameNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mFrameNumber;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getReason</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mReason;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 确定图像是否从相机捕获；如果是，则可以使用图像缓冲区</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">wasImageCaptured</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> !mDropped;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获取序列号；该序列号为 CameraCaptureSession.capture 的返回值</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSequenceId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mSequenceId;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="CameraMetadata"><a href="#CameraMetadata" class="headerlink" title="CameraMetadata"></a><code>CameraMetadata</code></h2><p>抽象类，是一个数据结构，包含了 <code>CameraDevice</code> 控制命令和相关信息。<code>CameraMetadata</code> 用于查询 <code>CameraDevice</code> 属性、捕获结果、设置请求参数的基本键/值映射。<br><code>CameraMetadata</code> 的所有实例都是不可变的，整个抽象类只提供一个公共方法：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;TKey&gt; <span class="title">getKeys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Class&lt;CameraMetadata&lt;TKey&gt;&gt; thisClass = </span><br><span class="line">        (Class&lt;CameraMetadata&lt;TKey&gt;&gt;) getClass();</span><br><span class="line">    <span class="keyword">return</span> Collections.unmodifiableList(</span><br><span class="line">            getKeys(thisClass, getKeyClass(), <span class="keyword">this</span>, <span class="comment">/*filterTags*/</span><span class="keyword">null</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从实现中可以看出 <code>getKeys()</code> 方法返回的键列表是永远不会更改的，任何键在整个对象生命周期内返回的值也不会更改。  </p>
<blockquote>
<p><code>CameraMetadata</code> 中定义的常量非常多，详细含义需要参考 <code>API</code> 中的详解。  </p>
</blockquote>
<h3 id="常量-2"><a href="#常量-2" class="headerlink" title="常量"></a>常量</h3><p><code>CameraMetadata</code> 支持的常量及对应含义：  </p>
<ul>
<li>色差校准模式 <code>COLOR_CORRECTION_ABERRATION</code><br><code>COLOR_CORRECTION_ABERRATION_MODE_FAST</code> ：色差校准时不会减慢传感器的捕获速率<br><code>COLOR_CORRECTION_ABERRATION_MODE_HIGH_QUALITY</code> ：色差校准时提高图像质量，但是传感器捕获率会降低<br><code>COLOR_CORRECTION_ABERRATION_MODE_OFF</code> ：关闭色差校准模式  </li>
<li>颜色校准模式 <code>COLOR_CORRECTION</code><br><code>COLOR_CORRECTION_MODE_FAST</code> ：颜色校准不会减慢传感器的捕获速率<br><code>COLOR_CORRECTION_MODE_HIGH_QUALITY</code> ：颜色校准时提高图片质量，但是传感器捕获率会被降低；可以用来做高级白平衡调整<br><code>COLOR_CORRECTION_MODE_TRANSFORM_MATRIX</code> ：使用矩阵转换，但是必须要禁用高级白平衡  </li>
<li>避免灯源工频干扰模式 <code>ANTIBANDING</code><br><code>CONTROL_AE_ANTIBANDING_MODE_50HZ</code> ：<code>CameraDevice</code> 调整曝光持续时间以避免 <code>50Hz</code> 照明光源干扰产生的明暗条纹问题<br><code>CONTROL_AE_ANTIBANDING_MODE_60HZ</code> ：避免 <code>60Hz</code> 照明光源的明暗条纹问题<br><code>CONTROL_AE_ANTIBANDING_MODE_AUTO</code> ：默认模式，自动适配照明光源的频率，来避免明暗条纹问题<br><code>CONTROL_AE_ANTIBANDING_MODE_OFF</code> ：不会调整曝光持续时间以避免出现明暗条纹问题  </li>
<li>自动曝光模式 <code>AE</code><br><code>CONTROL_AE_MODE_OFF</code> ：自动曝光关闭<br><code>CONTROL_AE_MODE_ON</code> ：自动曝光打开<br><code>CONTROL_AE_MODE_ON_ALWAYS_FLASH</code> ：自动曝光打开并总是闪光<br><code>CONTROL_AE_MODE_ON_AUTO_FLASH</code> ：自动曝光打开并自动闪光<br><code>CONTROL_AE_MODE_ON_AUTO_FLASH_REDEYE</code> ：自动曝光打开，自动闪光并消除红眼<br><code>CONTROL_AE_MODE_ON_EXTERNAL_FLASH</code> ：自动曝光，并打开外接闪光灯  </li>
<li>测光序列 <code>PRECAPTURE</code><br><code>CONTROL_AE_PRECAPTURE_TRIGGER_CANCEL</code> ：自动曝光前的测光序列，取消<br><code>CONTROL_AE_PRECAPTURE_TRIGGER_IDLE</code> ：测光序列空闲<br><code>CONTROL_AE_PRECAPTURE_TRIGGER_START</code> ：开启测光序列  </li>
<li>自动曝光状态 <code>AE_STATE</code><br><code>CONTROL_AE_STATE_CONVERGED</code> ：自动曝光状态良好<br><code>CONTROL_AE_STATE_FLASH_REQUIRED</code> ：自动曝光状态良好，但是需要打开闪光灯<br><code>CONTROL_AE_STATE_INACTIVE</code> ：自动曝光关闭，或者被重置<br><code>CONTROL_AE_STATE_LOCKED</code> ：自动曝光锁定<br><code>CONTROL_AE_STATE_PRECAPTURE</code> ：自动曝光需要发送测光序列<br><code>CONTROL_AE_STATE_SEARCHING</code> ：这是瞬间状态，表示自动曝光还没设置好，正在搜索  </li>
<li>自动对焦 <code>AF</code><br><code>CONTROL_AF_MODE_AUTO</code> ：基本自动对焦模式<br><code>CONTROL_AF_MODE_CONTINUOUS_PICTURE</code> ：自动对焦连续的修改镜头位置以提供恒定对焦的图像流<br><code>CONTROL_AF_MODE_CONTINUOUS_VIDEO</code> ：录像中的自动对焦<br><code>CONTROL_AF_MODE_EDOF</code> ：扩展景深模式 <code>Extended depth of field</code><br><code>CONTROL_AF_MODE_MACRO</code> ：特写聚焦模式<br><code>CONTROL_AF_MODE_OFF</code> ：自动对焦模式关闭  </li>
<li>自动对焦场景 <code>AF_SCENE</code><br><code>CONTROL_AF_SCENE_CHANGE_DETECTED</code> ：自动对焦区域内检测到场景变化<br><code>CONTROL_AF_SCENE_CHANGE_NOT_DETECTED</code> ：自动对焦区域场景变化不检测  </li>
<li>自动对焦状态 <code>AF_STATE</code><br><code>CONTROL_AF_STATE_ACTIVE_SCAN</code> ：自动对焦扫描<br><code>CONTROL_AF_STATE_FOCUSED_LOCKED</code> ：自动对焦，焦点锁定<br><code>CONTROL_AF_STATE_INACTIVE</code> ：自动对焦被关闭或者没有扫描过<br><code>CONTROL_AF_STATE_NOT_FOCUSED_LOCKED</code> ：自动对焦焦点锁定失败<br><code>CONTROL_AF_STATE_PASSIVE_FOCUSED</code> ：瞬态，自动对焦找到焦点，但是随时可能从新扫描<br><code>CONTROL_AF_STATE_PASSIVE_SCAN</code> ：瞬态，自动对焦正在扫描<br><code>CONTROL_AF_STATE_PASSIVE_UNFOCUSED</code> ：瞬态，自动对焦扫描后没有找到焦点，随时可以从新扫描  </li>
<li>自动对焦触发器 <code>AF_TRIGGER</code><br><code>CONTROL_AF_TRIGGER_CANCEL</code> ：取消自动对焦触发器<br><code>CONTROL_AF_TRIGGER_IDLE</code> ：触发器空闲<br><code>CONTROL_AF_TRIGGER_START</code> ：触发器触发自动对焦  </li>
<li>自动白平衡模式 <code>AWE</code><br><code>CONTROL_AWB_MODE_AUTO</code> ：基本自动白平衡模式<br><code>CONTROL_AWB_MODE_CLOUDY_DAYLIGHT</code> ：自动白平衡关闭，使用阴天日光作为白平衡的假定场景照明<br><code>CONTROL_AWB_MODE_DAYLIGHT</code> ：自动白平衡关闭，日光作为场景照明<br><code>CONTROL_AWB_MODE_FLUORESCENT</code> ：自动白平衡关闭，荧光灯<br><code>CONTROL_AWB_MODE_INCANDESCENT</code> ：自动白平衡关闭，白炽灯<br><code>CONTROL_AWB_MODE_OFF</code> ：自动白平衡关闭<br><code>CONTROL_AWB_MODE_SHADE</code> ：自动白平衡关闭，阴影<br><code>CONTROL_AWB_MODE_TWILIGHT</code> ：自动白平衡关闭，暮光<br><code>CONTROL_AWB_MODE_WARM_FLUORESCENT</code> ：自动白平衡关闭，暖荧光灯  </li>
<li>自动白平衡状态  <code>AWE_STATE</code><br><code>CONTROL_AWB_STATE_CONVERGED</code> ：自动白平衡状态良好<br><code>CONTROL_AWB_STATE_INACTIVE</code> ：自动白平衡还没有开启自动模式，或者还没有开始测量<br><code>CONTROL_AWB_STATE_LOCKED</code> ：自动白平衡锁定<br><code>CONTROL_AWB_STATE_SEARCHING</code> ：瞬态，自动白平衡还没有找到合适的值，处于搜索状态  </li>
<li>数据捕获请求 <code>CAPTURE_INTENT</code><br><code>CONTROL_CAPTURE_INTENT_CUSTOM</code> ：<code>CameraDevice</code> 默认的数据捕获请求<br><code>CONTROL_CAPTURE_INTENT_MANUAL</code> ：手动设置参数<br><code>CONTROL_CAPTURE_INTENT_MOTION_TRACKING</code> ：运动跟踪<br><code>CONTROL_CAPTURE_INTENT_PREVIEW</code> ：请求预览<br><code>CONTROL_CAPTURE_INTENT_STILL_CAPTURE</code> ：请求拍照<br><code>CONTROL_CAPTURE_INTENT_VIDEO_RECORD</code> ：请求录像<br><code>CONTROL_CAPTURE_INTENT_VIDEO_SNAPSHOT</code> ：请求视频快照<br><code>CONTROL_CAPTURE_INTENT_ZERO_SHUTTER_LAG</code> ：<code>ZSL</code> 零延时拍照请求  </li>
<li>颜色效果模式 <code>EFFECT_MODE</code><br><code>CONTROL_EFFECT_MODE_AQUA</code> ：蓝色色调 <code>AQUA</code> 模式<br><code>CONTROL_EFFECT_MODE_BLACKBOARD</code> ：黑板模式，黑色区域带有白色或灰色细节<br><code>CONTROL_EFFECT_MODE_MONO</code> ：<code>MONO</code> 单色调模式，将图像映射为单一颜色<br><code>CONTROL_EFFECT_MODE_NEGATIVE</code> ：<code>NEGATIVE</code> 负片模式，图像的颜色反转<br><code>CONTROL_EFFECT_MODE_OFF</code> ：颜色效果模式关闭<br><code>CONTROL_EFFECT_MODE_POSTERIZE</code> ：<code>POSTERIZE</code> 色调分离模式，图像使用离散的色调区域而不是连续的<br><code>CONTROL_EFFECT_MODE_SEPIA</code> ：<code>SEPIA</code> 棕褐色效果模式，图像被映射为暖灰色，红色和棕色色调<br><code>CONTROL_EFFECT_MODE_SOLARIZE</code> ：<code>SOLARIZE</code> 日晒效果模式，图像的色调完全或部分颠倒<br><code>CONTROL_EFFECT_MODE_WHITEBOARD</code> ：白板模式，图像通常显示为白色区域，具有黑色或灰色细节  </li>
<li><code>3A</code> 模式<br><code>CONTROL_MODE_AUTO</code> ：<code>3A: AE, AWE, AF</code> 都设置为自动模式<br><code>CONTROL_MODE_OFF</code> ：关闭 <code>3A</code>，所有的效果都是手动控制<br><code>CONTROL_MODE_OFF_KEEP_STATE</code> ：和模式关闭相同，但是使用 <code>3A</code> 算法来更新统计信息<br><code>CONTROL_MODE_USE_SCENE_MODE</code> ：使用特殊场景模式  </li>
<li>场景模式 <code>SCENE_MODE</code><br><code>CONTROL_SCENE_MODE_ACTION</code> ：对快速移动物体的优化<br><code>CONTROL_SCENE_MODE_BARCODE</code> ：用于准确捕获条形码照片的优化<br><code>CONTROL_SCENE_MODE_BEACH</code> ：海滩场景，适合户外、明亮的场景<br><code>CONTROL_SCENE_MODE_CANDLELIGHT</code> ：火焰场景，适合光源为火焰的昏暗场景<br><code>CONTROL_SCENE_MODE_DISABLED</code> ：关闭场景模式<br><code>CONTROL_SCENE_MODE_FACE_PRIORITY</code> ：人脸场景，如果支持人脸检测，使用 <code>3A</code> 优化数据<br><code>CONTROL_SCENE_MODE_FIREWORKS</code> ：烟火场景，为晚上的烟火优化图片<br><code>CONTROL_SCENE_MODE_HDR</code> ：<code>HDR</code> 高动态范围模式，需要更长的时间捕获单个图像<br><code>CONTROL_SCENE_MODE_HIGH_SPEED_VIDEO</code> ：已经废弃，主要用于高速录像场景<br><code>CONTROL_SCENE_MODE_LANDSCAPE</code> ：风景场景，用于优化远距离拍摄图片<br><code>CONTROL_SCENE_MODE_NIGHT</code> ：夜间场景，用于优化低光场景下的图片<br><code>CONTROL_SCENE_MODE_NIGHT_PORTRAIT</code> ：夜间人像，用于优化低光场景下的人像拍摄<br><code>CONTROL_SCENE_MODE_PARTY</code> ：聚会场景，适合昏暗、室内、多个移动人像的场景<br><code>CONTROL_SCENE_MODE_PORTRAIT</code> ：人像场景<br><code>CONTROL_SCENE_MODE_SNOW</code> ：雪景，适合明亮、室外、包含雪的场景<br><code>CONTROL_SCENE_MODE_SPORTS</code> ：运动场景，适合快速移动的人物<br><code>CONTROL_SCENE_MODE_STEADYPHOTO</code> ：优化设备小幅移动导致的图像模糊，比如手抖<br><code>CONTROL_SCENE_MODE_SUNSET</code> ：日落场景<br><code>CONTROL_SCENE_MODE_THEATRE</code> ：剧场场景，适合昏暗、室内、闪光灯关闭的场景  </li>
<li>录像防抖模式 <code>VIDEO_STABILIZATION</code><br><code>CONTROL_VIDEO_STABILIZATION_MODE_OFF</code> ：录像防抖模式关闭<br><code>CONTROL_VIDEO_STABILIZATION_MODE_ON</code> ：录像防抖模式开启  </li>
<li>失真校准模式 <code>DISTORTION_CORRECTION</code><br><code>DISTORTION_CORRECTION_MODE_FAST</code> ：镜头失真校准，在不降低传感器帧率情况下使用镜头失真校准<br><code>DISTORTION_CORRECTION_MODE_HIGH_QUALITY</code> ：高质量失真校准，但是会降低传感器帧率<br><code>DISTORTION_CORRECTION_MODE_OFF</code> ：失真校准模式关闭  </li>
<li>边缘增强 <code>EDGE_MODE</code><br><code>EDGE_MODE_FAST</code> ：边缘增强，不降低传感器帧率<br><code>EDGE_MODE_HIGH_QUALITY</code> ：高质量边缘增强，但是会降低传感器帧率<br><code>EDGE_MODE_OFF</code> ：边缘增强关闭<br><code>EDGE_MODE_ZERO_SHUTTER_LAG</code> ：<code>ZSL</code> 零延时边缘增强  </li>
<li>闪光模式 <code>FLASH_MODE</code><br><code>FLASH_MODE_OFF</code> ：图片捕获时不使用闪光灯<br><code>FLASH_MODE_SINGLE</code> ：如果闪光灯有效并有电，则开启闪光灯<br><code>FLASH_MODE_TORCH</code> ：闪光灯手电筒模式<br><code>FLASH_STATE_CHARGING</code> ：闪光灯正在充电，不能使用<br><code>FLASH_STATE_FIRED</code> ：这次图片捕获时，使用闪光灯<br><code>FLASH_STATE_PARTIAL</code> ：闪光灯部分照亮这帧图片  </li>
<li>闪光灯状态 <code>FLASH_STATE</code><br><code>FLASH_STATE_READY</code> ：闪光灯已经准备好闪光<br><code>FLASH_STATE_UNAVAILABLE</code> ：没有闪光灯  </li>
<li>热点校正 <code>HOT_PIXEL</code><br><code>HOT_PIXEL_MODE_FAST</code> ：传感器的热噪声：热点 <code>hot pixel</code> ，是因为芯片温度过高产生的噪点。开启热点校正，但不降低传感器帧率<br><code>HOT_PIXEL_MODE_HIGH_QUALITY</code> ：高质量的热点校正，但会降低传感器帧率<br><code>HOT_PIXEL_MODE_OFF</code> ：热点校正关闭  </li>
<li>相机硬件设备可控级别 <code>SUPPORTED_HARDWARE_LEVEL</code><br>各个模式支持的功能级别 <code>LEGACY &lt; LIMITED &lt; FULL &lt; LEVEL_3</code><br><code>INFO_SUPPORTED_HARDWARE_LEVEL_3</code> ：最高权限，全层可控，并且可以进行 <code>YUV</code> 的再处理和原始数据捕获<br><code>INFO_SUPPORTED_HARDWARE_LEVEL_EXTERNAL</code> ：摄像头设备为外接设备<br><code>INFO_SUPPORTED_HARDWARE_LEVEL_FULL</code> ：支持对每一帧数据进行控制,还支持高速率的图片拍摄<br><code>INFO_SUPPORTED_HARDWARE_LEVEL_LIMITED</code> ：受限模式，支持一些基本功能；还有部分额外功能（<code>FULL</code> 子集）<br><code>INFO_SUPPORTED_HARDWARE_LEVEL_LEGACY</code> ：向后兼容模式  </li>
<li>镜头人头方向 <code>LENS_FACING</code><br><code>LENS_FACING_BACK</code> ：摄像头镜头成像方向与屏幕预览的关系，镜头与屏幕预览方向相反<br><code>LENS_FACING_EXTERNAL</code> ：外置摄像头，镜头与屏幕方向没有关系<br><code>LENS_FACING_FRONT</code> ：镜头与屏幕预览方向相同  </li>
<li>镜头聚焦距离测量 <code>LENS_INFO_FOCUS_DISTANCE_CALIBRATION</code><br><code>LENS_INFO_FOCUS_DISTANCE_CALIBRATION_APPROXIMATE</code> ：镜头焦距以屈光度测量<br><code>LENS_INFO_FOCUS_DISTANCE_CALIBRATION_CALIBRATED</code> ：镜头焦距以屈光度测量并校准<br><code>LENS_INFO_FOCUS_DISTANCE_CALIBRATION_UNCALIBRATED</code> ：镜头焦距不准确，没有校准过  </li>
<li>镜头光学防抖 <code>OIS: LENS_OPTICAL_STABILIZATION</code><br><code>LENS_OPTICAL_STABILIZATION_MODE_OFF</code> ：镜头光学防抖关闭<br><code>LENS_OPTICAL_STABILIZATION_MODE_ON</code> ：镜头光学防抖开启  </li>
<li>镜头光学中心位置 <code>LENS_POSE_REFERENCE</code><br><code>LENS_POSE_REFERENCE_GYROSCOPE</code> ：镜头光学中心位置优先使用陀螺仪<br><code>LENS_POSE_REFERENCE_PRIMARY_CAMERA</code> ：镜头光学中心位置与相机相同方向  </li>
<li>镜头状态<br><code>LENS_STATE_MOVING</code> ：一个或者几个镜头的参数正在改变<br><code>LENS_STATE_STATIONARY</code> ：镜头参数不会改变  </li>
<li>多图像传感器的同步 <code>MULTI_CAMERA_SENSOR_SYNC</code><br><code>LOGICAL_MULTI_CAMERA_SENSOR_SYNC_TYPE_APPROXIMATE</code> ：软件同步，图像的时间戳来自于传感器开始曝光的近似值<br><code>LOGICAL_MULTI_CAMERA_SENSOR_SYNC_TYPE_CALIBRATED</code> ：硬件同步，时间戳为准确值  </li>
<li>降噪模式 <code>NOISE_REDUCTION</code><br><code>NOISE_REDUCTION_MODE_FAST</code> ：开启降噪模式，不降低传感器帧率<br><code>NOISE_REDUCTION_MODE_HIGH_QUALITY</code> ：高质量降噪模式，但会降低传感器帧率<br><code>NOISE_REDUCTION_MODE_MINIMAL</code> ：在不降低传感器帧率情况下，将噪声降到最小<br><code>NOISE_REDUCTION_MODE_OFF</code> ：降噪模式关闭<br><code>NOISE_REDUCTION_MODE_ZERO_SHUTTER_LAG</code> ：<code>ZSL</code> 零延时降噪模式  </li>
<li>有效请求功能集 <code>REQUEST_AVAILABLE_CAPABILITIES</code><br><code>REQUEST_AVAILABLE_CAPABILITIES_BACKWARD_COMPATIBLE</code> ：向后兼容，每个摄像头设备支持的最小功能集<br><code>REQUEST_AVAILABLE_CAPABILITIES_BURST_CAPTURE</code> ：当后期处理设置为 <code>FAST</code> 模式时，<code>CameraDevice</code> 支持以大于等于 20帧/秒（至少未压缩的YUV格式）的速度捕获高分辨率图像；也可以大于等于 10帧/秒的速度捕获最大分辨率图像。高分辨率至少 800 万像素或设备的最大分辨率，以较小者为准<br><code>REQUEST_AVAILABLE_CAPABILITIES_CONSTRAINED_HIGH_SPEED_VIDEO</code> ：设备支持高速视频录制（帧率大于等于 120 帧/秒）<br><code>REQUEST_AVAILABLE_CAPABILITIES_DEPTH_OUTPUT</code> ：支持景深<br><code>REQUEST_AVAILABLE_CAPABILITIES_LOGICAL_MULTI_CAMERA</code> ：支持两个或多个物理摄像头<br><code>REQUEST_AVAILABLE_CAPABILITIES_MANUAL_POST_PROCESSING</code> ：支持图像手动后期处理<br><code>REQUEST_AVAILABLE_CAPABILITIES_MANUAL_SENSOR</code> ：支持传感器获取图像阶段的手动控制，比如 <code>3A</code> 算法控制<br><code>REQUEST_AVAILABLE_CAPABILITIES_MONOCHROME</code> ：单色相机，<code>U, V</code> 的值都是 128<br><code>REQUEST_AVAILABLE_CAPABILITIES_MOTION_TRACKING</code> ：支持运动追踪<br><code>REQUEST_AVAILABLE_CAPABILITIES_PRIVATE_REPROCESSING</code> ：支持零延时 <code>ZSL</code><br><code>REQUEST_AVAILABLE_CAPABILITIES_RAW</code> ：支持传感器的原始缓冲区数据<br><code>REQUEST_AVAILABLE_CAPABILITIES_READ_SENSOR_SETTINGS</code> ：<code>3A</code> 在运行时，支持读取传感器的设置<br><code>REQUEST_AVAILABLE_CAPABILITIES_YUV_REPROCESSING</code> ：和 <code>PRIVATE_REPROCESSING</code> 类似，支持 <code>YUV_420_888</code>  </li>
<li>裁剪类型 <code>CROPPING</code><br><code>SCALER_CROPPING_TYPE_CENTER_ONLY</code> ：仅支持中央裁剪区域<br><code>SCALER_CROPPING_TYPE_FREEFORM</code> ：支持任意选择裁剪区域  </li>
<li>颜色滤镜 <code>COLOR_FILTER</code><br><code>SENSOR_INFO_COLOR_FILTER_ARRANGEMENT_BGGR</code> ：颜色滤镜即传感器中 <code>Bayer</code> 格式图像的 <code>RGB</code> 滤色器，从左上角开始每个 2x2 的像素区域使用的颜色滤镜组合；当前为 <code>BGGR</code><br><code>SENSOR_INFO_COLOR_FILTER_ARRANGEMENT_GBRG</code> ：2x2 区域为 <code>GBRG</code><br><code>SENSOR_INFO_COLOR_FILTER_ARRANGEMENT_GRBG</code> ：2x2 区域为 <code>GRBG</code><br><code>SENSOR_INFO_COLOR_FILTER_ARRANGEMENT_RGB</code> ：传感器输出不是 <code>Bayer</code> 格式的图像，输出的是每个像素 3<em>16 位值，而不是 1</em>16<br><code>SENSOR_INFO_COLOR_FILTER_ARRANGEMENT_RGGB</code> ：2x2 区域为 <code>RGGB</code>  </li>
<li>时间戳 <code>TIMESTAMP</code><br><code>SENSOR_INFO_TIMESTAMP_SOURCE_REALTIME</code> ：时间戳和系统时间相同<br><code>SENSOR_INFO_TIMESTAMP_SOURCE_UNKNOWN</code> ：时间戳以纳秒为单位，并不能和其他子系统对比  </li>
<li>光源色温 <code>ILLUMINANT</code><br><code>SENSOR_REFERENCE_ILLUMINANT1_CLOUDY_WEATHER</code> ：指的是人造标准光源的类型，模拟环境光源。模拟多云天<br><code>SENSOR_REFERENCE_ILLUMINANT1_COOL_WHITE_FLUORESCENT</code> ：模拟白色荧光，<code>W 3900 - 4500 K</code><br><code>SENSOR_REFERENCE_ILLUMINANT1_D50</code> ：<code>D50, 5000K</code> 模拟太阳光色温<br><code>SENSOR_REFERENCE_ILLUMINANT1_D55</code> ：<code>D55</code><br><code>SENSOR_REFERENCE_ILLUMINANT1_D65</code> ：<code>D65 6500K</code> 国际标准人工日光色温<br><code>SENSOR_REFERENCE_ILLUMINANT1_D75</code> ：<code>D75 75000K</code> 模拟北方平均太阳光色温<br><code>SENSOR_REFERENCE_ILLUMINANT1_DAYLIGHT</code> ：模拟白天<br><code>SENSOR_REFERENCE_ILLUMINANT1_DAYLIGHT_FLUORESCENT</code> ：白天荧光 <code>D 5700 - 7100K</code><br><code>SENSOR_REFERENCE_ILLUMINANT1_DAY_WHITE_FLUORESCENT</code> ：白天白色荧光 <code>N 4600 - 5400K</code><br><code>SENSOR_REFERENCE_ILLUMINANT1_FINE_WEATHER</code> ：模拟好天气<br><code>SENSOR_REFERENCE_ILLUMINANT1_FLASH</code> ：闪光灯<br><code>SENSOR_REFERENCE_ILLUMINANT1_FLUORESCENT</code> ：荧光灯<br><code>SENSOR_REFERENCE_ILLUMINANT1_ISO_STUDIO_TUNGSTEN</code> ：标准钨丝灯<br><code>SENSOR_REFERENCE_ILLUMINANT1_SHADE</code> ：阴影<br><code>SENSOR_REFERENCE_ILLUMINANT1_STANDARD_A</code> ：美式橱窗射灯 <code>2856K</code><br><code>SENSOR_REFERENCE_ILLUMINANT1_STANDARD_B</code> ：<br><code>SENSOR_REFERENCE_ILLUMINANT1_STANDARD_C</code> ：<br><code>SENSOR_REFERENCE_ILLUMINANT1_TUNGSTEN</code> ：白炽灯<br><code>SENSOR_REFERENCE_ILLUMINANT1_WHITE_FLUORESCENT</code> ：白色荧光灯 <code>WW 3200 - 3700K</code>  </li>
<li>测试图案 <code>TEST_PATTERN</code><br><code>SENSOR_TEST_PATTERN_MODE_COLOR_BARS</code> ：使用 8 条彩色图案：白、黄、青、绿、品红、红、蓝、黑<br><code>SENSOR_TEST_PATTERN_MODE_COLOR_BARS_FADE_TO_GRAY</code> ：和 <code>COLOR_BARS</code> 类似，但是从顶部到底部淡化成灰色<br><code>SENSOR_TEST_PATTERN_MODE_CUSTOM1</code> ：自定义模式，图片必须是静态的<br><code>SENSOR_TEST_PATTERN_MODE_OFF</code> ：默认值，没有使用测试图案，直接返回传感器捕获的数据<br><code>SENSOR_TEST_PATTERN_MODE_PN9</code> ：所有像素数据由从 <code>PN9 512</code> 位序列生成的伪随机序列<br><code>SENSOR_TEST_PATTERN_MODE_SOLID_COLOR</code> ：所有像素由颜色通道代替  </li>
<li>镜头阴影校正 <code>Lens SHADING</code><br><code>SHADING_MODE_FAST</code> ：镜头均匀性指画面中心的明亮度到四周的明亮度比值。阴影校正，不会降低传感器帧率<br><code>SHADING_MODE_HIGH_QUALITY</code> ：高质量的阴影校正，但会降低帧率<br><code>SHADING_MODE_OFF</code> ：没有校正  </li>
<li>人脸检测 <code>FACE DETECT</code><br><code>STATISTICS_FACE_DETECT_MODE_FULL</code> ：返回人脸检测所有元数据：面部矩形，分数，<code>ID</code> 等<br><code>STATISTICS_FACE_DETECT_MODE_OFF</code> ：人脸检测统计数据关闭<br><code>STATISTICS_FACE_DETECT_MODE_SIMPLE</code> ：仅返回人脸矩形，置信度  </li>
<li>镜头均匀性阴影图 <code>LENS SHADING MAP</code><br><code>STATISTICS_LENS_SHADING_MAP_MODE_OFF</code> ：传感器输出的数据中不包含镜头阴影图<br><code>STATISTICS_LENS_SHADING_MAP_MODE_ON</code> ：传感器输出的数据中包含镜头阴影图  </li>
<li>光学防抖数据 <code>OIS DATA</code><br><code>STATISTICS_OIS_DATA_MODE_OFF</code> ：传感器输出数据不包含光学防抖位置信息<br><code>STATISTICS_OIS_DATA_MODE_ON</code> ：传感器输出数据包含光学防抖位置信息  </li>
<li>照明闪烁 <code>FLICKER</code><br><code>STATISTICS_SCENE_FLICKER_50HZ</code> ：<code>CameraDevice</code> 检查当前场景照明闪烁 <code>50HZ</code><br><code>STATISTICS_SCENE_FLICKER_60HZ</code> ：闪烁为 <code>60HZ</code><br><code>STATISTICS_SCENE_FLICKER_NONE</code> ：不去检查  </li>
<li>最大延迟同步 <code>LATENCY</code><br><code>SYNC_MAX_LATENCY_PER_FRAME_CONTROL</code> ：每帧都去检查最大延迟同步<br><code>SYNC_MAX_LATENCY_UNKNOWN</code> ：不确定延迟同步  </li>
<li>色调映射模式 <code>TONEMAP MODE</code><br><code>TONEMAP_MODE_CONTRAST_CURVE</code> ：不会降低传感器帧率，使用指定色调映射曲线<br><code>TONEMAP_MODE_FAST</code> ：不会降低传感器帧率，使用高级伽马映射和颜色增强<br><code>TONEMAP_MODE_GAMMA_VALUE</code> ：不会降低帧率，使用伽马值进行颜色映射，禁用其他色调映射和颜色增强<br><code>TONEMAP_MODE_HIGH_QUALITY</code> ：高质量的伽马映射和颜色增强，会降低帧率<br><code>TONEMAP_MODE_PRESET_CURVE</code> ：不会降低帧率，使用预设的色调映射曲线来执行色调映射，禁用其他色调映射和颜色增强  </li>
<li>色调映射曲线预设值 <code>TONEMAP PRESET CURVE</code><br><code>TONEMAP_PRESET_CURVE_REC709</code> ：色调映射曲线预设 <code>ITU-R BT.709</code><br><code>TONEMAP_PRESET_CURVE_SRGB</code> ：色调映射曲线预设 <code>sRGB</code>  </li>
</ul>
<h2 id="CameraCharacteristics"><a href="#CameraCharacteristics" class="headerlink" title="CameraCharacteristics"></a><code>CameraCharacteristics</code></h2><p>继承 <code>CameraMetadata</code> ，用来描述 <code>CameraDevice</code> 设备的属性，这些属性是不可修改的，设备出厂时提供的；可以通过 <code>CameraManager.getCameraCharacteristics(String cameraID)</code> 来查询当前设备支持哪些属性。  </p>
<h3 id="Key-常量"><a href="#Key-常量" class="headerlink" title="Key 常量"></a><code>Key</code> 常量</h3><p><code>CameraCharacteristics</code> 支持的 <code>Key</code> 常量及对应含义，这些值都是从 <code>system/media/camera/docs</code> 中自动解析生成的：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// 相差矫正模式列表</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">int</span>[]&gt; </span><br><span class="line">      COLOR_CORRECTION_AVAILABLE_ABERRATION_MODES =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;<span class="keyword">int</span>[]&gt;(<span class="string">"android.colorCorrection.availableAberrationModes"</span>,</span><br><span class="line">      <span class="keyword">int</span>[].class);</span><br><span class="line">  <span class="comment">// 自动曝光避免工频干扰列表</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">int</span>[]&gt; </span><br><span class="line">      CONTROL_AE_AVAILABLE_ANTIBANDING_MODES =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;<span class="keyword">int</span>[]&gt;(<span class="string">"android.control.aeAvailableAntibandingModes"</span>,</span><br><span class="line">      <span class="keyword">int</span>[].class);</span><br><span class="line">  <span class="comment">// 自动曝光模式列表  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">int</span>[]&gt; CONTROL_AE_AVAILABLE_MODES =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;<span class="keyword">int</span>[]&gt;(<span class="string">"android.control.aeAvailableModes"</span>, <span class="keyword">int</span>[].class);</span><br><span class="line">  <span class="comment">// 支持的帧率范围  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;android.util.Range&lt;Integer&gt;[]&gt; </span><br><span class="line">      CONTROL_AE_AVAILABLE_TARGET_FPS_RANGES =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;android.util.Range&lt;Integer&gt;[]&gt;(</span><br><span class="line">          <span class="string">"android.control.aeAvailableTargetFpsRanges"</span>, </span><br><span class="line">          <span class="keyword">new</span> TypeReference&lt;android.util.Range&lt;Integer&gt;[]&gt;() &#123;&#123; &#125;&#125;);</span><br><span class="line">  <span class="comment">// 自动曝光补偿值范围  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;android.util.Range&lt;Integer&gt;&gt; </span><br><span class="line">      CONTROL_AE_COMPENSATION_RANGE =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;android.util.Range&lt;Integer&gt;&gt;(</span><br><span class="line">          <span class="string">"android.control.aeCompensationRange"</span>, </span><br><span class="line">          <span class="keyword">new</span> TypeReference&lt;android.util.Range&lt;Integer&gt;&gt;() &#123;&#123; &#125;&#125;);</span><br><span class="line">  <span class="comment">// 自动曝光补偿值最小步进  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Rational&gt; CONTROL_AE_COMPENSATION_STEP =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;Rational&gt;(<span class="string">"android.control.aeCompensationStep"</span>, </span><br><span class="line">      Rational.class);</span><br><span class="line">  <span class="comment">// 是否支持 AE 锁  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Boolean&gt; CONTROL_AE_LOCK_AVAILABLE =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;Boolean&gt;(<span class="string">"android.control.aeLockAvailable"</span>,<span class="keyword">boolean</span>.class);</span><br><span class="line">  <span class="comment">// 自动对焦模式列表  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">int</span>[]&gt; CONTROL_AF_AVAILABLE_MODES =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;<span class="keyword">int</span>[]&gt;(<span class="string">"android.control.afAvailableModes"</span>, <span class="keyword">int</span>[].class);</span><br><span class="line">  <span class="comment">// 颜色效果列表  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">int</span>[]&gt; CONTROL_AVAILABLE_EFFECTS =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;<span class="keyword">int</span>[]&gt;(<span class="string">"android.control.availableEffects"</span>, <span class="keyword">int</span>[].class);</span><br><span class="line">  <span class="comment">// 控制模式列表  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">int</span>[]&gt; CONTROL_AVAILABLE_MODES =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;<span class="keyword">int</span>[]&gt;(<span class="string">"android.control.availableModes"</span>, <span class="keyword">int</span>[].class);</span><br><span class="line">  <span class="comment">// 场景模式列表  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">int</span>[]&gt; CONTROL_AVAILABLE_SCENE_MODES =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;<span class="keyword">int</span>[]&gt;(<span class="string">"android.control.availableSceneModes"</span>,<span class="keyword">int</span>[].class);</span><br><span class="line">  <span class="comment">// 视频防抖模式列表</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">int</span>[]&gt; </span><br><span class="line">      CONTROL_AVAILABLE_VIDEO_STABILIZATION_MODES =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;<span class="keyword">int</span>[]&gt;(<span class="string">"android.control.availableVideoStabilizationModes"</span>,</span><br><span class="line">      <span class="keyword">int</span>[].class);</span><br><span class="line">  <span class="comment">// 自动白平衡列表  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">int</span>[]&gt; CONTROL_AWB_AVAILABLE_MODES =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;<span class="keyword">int</span>[]&gt;(<span class="string">"android.control.awbAvailableModes"</span>, <span class="keyword">int</span>[].class);</span><br><span class="line">  <span class="comment">// 是否支持自动白平衡锁  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Boolean&gt; CONTROL_AWB_LOCK_AVAILABLE =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;Boolean&gt;(<span class="string">"android.control.awbLockAvailable"</span>,<span class="keyword">boolean</span>.class);</span><br><span class="line">  <span class="comment">// 自动曝光，测量区域最大值  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; CONTROL_MAX_REGIONS_AE =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.control.maxRegionsAe"</span>, <span class="keyword">int</span>.class);</span><br><span class="line">  <span class="comment">// 自动对焦，测量区域最大值  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; CONTROL_MAX_REGIONS_AF =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.control.maxRegionsAf"</span>, <span class="keyword">int</span>.class);</span><br><span class="line">  <span class="comment">// 自动白平衡，测量区域最大值  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; CONTROL_MAX_REGIONS_AWB =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.control.maxRegionsAwb"</span>, <span class="keyword">int</span>.class);</span><br><span class="line">  <span class="comment">// 传感器灵敏度增强范围  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;android.util.Range&lt;Integer&gt;&gt; </span><br><span class="line">      CONTROL_POST_RAW_SENSITIVITY_BOOST_RANGE =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;android.util.Range&lt;Integer&gt;&gt;(</span><br><span class="line">      <span class="string">"android.control.postRawSensitivityBoostRange"</span>, </span><br><span class="line">      <span class="keyword">new</span> TypeReference&lt;android.util.Range&lt;Integer&gt;&gt;() &#123;&#123; &#125;&#125;);</span><br><span class="line">  <span class="comment">// 指示捕获目标能否同时输出 DEPTH16/DEPTH_POIN </span></span><br><span class="line">  <span class="comment">// 或者正常模式 YUV_420_888, JPEG, RAW</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Boolean&gt; DEPTH_DEPTH_IS_EXCLUSIVE =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;Boolean&gt;(<span class="string">"android.depth.depthIsExclusive"</span>, <span class="keyword">boolean</span>.class);</span><br><span class="line">  <span class="comment">// 失真校准模式列表  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">int</span>[]&gt; DISTORTION_CORRECTION_AVAILABLE_MODES=.;</span><br><span class="line">  <span class="comment">// 边缘增强模式列表  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">int</span>[]&gt; EDGE_AVAILABLE_EDGE_MODES =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;<span class="keyword">int</span>[]&gt;(<span class="string">"android.edge.availableEdgeModes"</span>, <span class="keyword">int</span>[].class);</span><br><span class="line">  <span class="comment">// 是否有闪光灯  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Boolean&gt; FLASH_INFO_AVAILABLE =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;Boolean&gt;(<span class="string">"android.flash.info.available"</span>, <span class="keyword">boolean</span>.class);</span><br><span class="line">  <span class="comment">// 热点矫正模式列表  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">int</span>[]&gt; HOT_PIXEL_AVAILABLE_HOT_PIXEL_MODES =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;<span class="keyword">int</span>[]&gt;(<span class="string">"android.hotPixel.availableHotPixelModes"</span>, </span><br><span class="line">      <span class="keyword">int</span>[].class);</span><br><span class="line">  <span class="comment">// 相机全功能支持级别  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; INFO_SUPPORTED_HARDWARE_LEVEL =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.info.supportedHardwareLevel"</span>,<span class="keyword">int</span>.class);</span><br><span class="line">  <span class="comment">// 相机设备制造商信息，如 ISP 硬件，传感器等等  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;String&gt; INFO_VERSION=...;</span><br><span class="line">  <span class="comment">// JPEG 缩略图大小  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;android.util.Size[]&gt; </span><br><span class="line">      JPEG_AVAILABLE_THUMBNAIL_SIZES =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;android.util.Size[]&gt;(<span class="string">"android.jpeg.availableThumbnailSizes"</span>,</span><br><span class="line">      android.util.Size[].class);</span><br><span class="line">  <span class="comment">// 镜头失真校准系数  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">float</span>[]&gt; LENS_DISTORTION=...;</span><br><span class="line">  <span class="comment">// 相机相对屏幕的方向  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; LENS_FACING =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.lens.facing"</span>, <span class="keyword">int</span>.class);</span><br><span class="line">  <span class="comment">// 相机支持的光圈大小列表  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">float</span>[]&gt; LENS_INFO_AVAILABLE_APERTURES =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;<span class="keyword">float</span>[]&gt;(<span class="string">"android.lens.info.availableApertures"</span>, </span><br><span class="line">      <span class="keyword">float</span>[].class);</span><br><span class="line">  <span class="comment">// 中性密度滤镜值列表  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">float</span>[]&gt; LENS_INFO_AVAILABLE_FILTER_DENSITIES =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;<span class="keyword">float</span>[]&gt;(<span class="string">"android.lens.info.availableFilterDensities"</span>, </span><br><span class="line">          <span class="keyword">float</span>[].class);</span><br><span class="line">  <span class="comment">// 焦距长度列表  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">float</span>[]&gt; LENS_INFO_AVAILABLE_FOCAL_LENGTHS =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;<span class="keyword">float</span>[]&gt;(<span class="string">"android.lens.info.availableFocalLengths"</span>, </span><br><span class="line">          <span class="keyword">float</span>[].class);</span><br><span class="line">  <span class="comment">// 光学防抖模式列表  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">int</span>[]&gt; </span><br><span class="line">      LENS_INFO_AVAILABLE_OPTICAL_STABILIZATION =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;<span class="keyword">int</span>[]&gt;(<span class="string">"android.lens.info.availableOpticalStabilization"</span>,</span><br><span class="line">      <span class="keyword">int</span>[].class);</span><br><span class="line">  <span class="comment">// 镜头焦距校准质量  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; LENS_INFO_FOCUS_DISTANCE_CALIBRATION=</span><br><span class="line">          <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.lens.info.focusDistanceCalibration"</span>,</span><br><span class="line">          <span class="keyword">int</span>.class);</span><br><span class="line">  <span class="comment">// 镜头超焦距  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Float&gt; LENS_INFO_HYPERFOCAL_DISTANCE =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;Float&gt;(<span class="string">"android.lens.info.hyperfocalDistance"</span>, </span><br><span class="line">          <span class="keyword">float</span>.class);</span><br><span class="line">  <span class="comment">// 镜头进入清晰焦点的最短距离  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Float&gt; LENS_INFO_MINIMUM_FOCUS_DISTANCE =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;Float&gt;(<span class="string">"android.lens.info.minimumFocusDistance"</span>, </span><br><span class="line">          <span class="keyword">float</span>.class);</span><br><span class="line">  <span class="comment">// 镜头固有的校准参数  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">float</span>[]&gt; LENS_INTRINSIC_CALIBRATION =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;<span class="keyword">float</span>[]&gt;(<span class="string">"android.lens.intrinsicCalibration"</span>, </span><br><span class="line">          <span class="keyword">float</span>[].class);</span><br><span class="line">  <span class="comment">// 不同的校准方法或校准用例，产生最好或最坏结果依赖于选取区域</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; LENS_POSE_REFERENCE=...;</span><br><span class="line">  <span class="comment">// 镜头坐标体系的方向  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">float</span>[]&gt; LENS_POSE_ROTATION =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;<span class="keyword">float</span>[]&gt;(<span class="string">"android.lens.poseRotation"</span>, <span class="keyword">float</span>[].class);</span><br><span class="line">  <span class="comment">// 镜头光学中心位置  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">float</span>[]&gt; LENS_POSE_TRANSLATION =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;<span class="keyword">float</span>[]&gt;(<span class="string">"android.lens.poseTranslation"</span>, <span class="keyword">float</span>[].class);</span><br><span class="line">  <span class="comment">// 降级，使用 LENS_DISTORTION 替代  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">float</span>[]&gt; LENS_RADIAL_DISTORTION =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;<span class="keyword">float</span>[]&gt;(<span class="string">"android.lens.radialDistortion"</span>, <span class="keyword">float</span>[].class);</span><br><span class="line">  <span class="comment">// 多传感器时间戳同步类型  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; LOGICAL_MULTI_CAMERA_SENSOR_SYNC_TYPE=.;</span><br><span class="line">  <span class="comment">// 降噪模式列表  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">int</span>[]&gt; </span><br><span class="line">      NOISE_REDUCTION_AVAILABLE_NOISE_REDUCTION_MODES =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;<span class="keyword">int</span>[]&gt;(</span><br><span class="line">          <span class="string">"android.noiseReduction.availableNoiseReductionModes"</span>,</span><br><span class="line">          <span class="keyword">int</span>[].class);</span><br><span class="line">  <span class="comment">// 最大的停顿时间  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; REPROCESS_MAX_CAPTURE_STALL =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.reprocess.maxCaptureStall"</span>, <span class="keyword">int</span>.class);</span><br><span class="line">  <span class="comment">// 相机支持的功能列表  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">int</span>[]&gt; REQUEST_AVAILABLE_CAPABILITIES =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;<span class="keyword">int</span>[]&gt;(<span class="string">"android.request.availableCapabilities"</span>, </span><br><span class="line">      <span class="keyword">int</span>[].class);</span><br><span class="line">  <span class="comment">// 最大输入流  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; REQUEST_MAX_NUM_INPUT_STREAMS =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.request.maxNumInputStreams"</span>, </span><br><span class="line">          <span class="keyword">int</span>.class);</span><br><span class="line">  <span class="comment">// 最大输出流（并发）  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; REQUEST_MAX_NUM_OUTPUT_PROC =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.request.maxNumOutputProc"</span>, </span><br><span class="line">          <span class="keyword">int</span>.class);</span><br><span class="line">  <span class="comment">// 最大输出流（同步）  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; </span><br><span class="line">      REQUEST_MAX_NUM_OUTPUT_PROC_STALLING =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.request.maxNumOutputProcStalling"</span>,</span><br><span class="line">          <span class="keyword">int</span>.class);</span><br><span class="line">  <span class="comment">// RAW 格式最大输出流  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; REQUEST_MAX_NUM_OUTPUT_RAW =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.request.maxNumOutputRaw"</span>, <span class="keyword">int</span>.class);</span><br><span class="line">  <span class="comment">// 定义输出结果可以有多少个子结果  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; REQUEST_PARTIAL_RESULT_COUNT =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.request.partialResultCount"</span>, <span class="keyword">int</span>.class);</span><br><span class="line">  <span class="comment">// 最大管道深度  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Byte&gt; REQUEST_PIPELINE_MAX_DEPTH =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;Byte&gt;(<span class="string">"android.request.pipelineMaxDepth"</span>, <span class="keyword">byte</span>.class);</span><br><span class="line">  <span class="comment">// 最大数字变焦比率  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Float&gt; SCALER_AVAILABLE_MAX_DIGITAL_ZOOM =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;Float&gt;(<span class="string">"android.scaler.availableMaxDigitalZoom"</span>, </span><br><span class="line">      <span class="keyword">float</span>.class);</span><br><span class="line">  <span class="comment">// 支持的裁剪类型  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; SCALER_CROPPING_TYPE =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.scaler.croppingType"</span>, <span class="keyword">int</span>.class);</span><br><span class="line">  <span class="comment">// 图像格式对应的输出配置表  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;</span><br><span class="line">      android.hardware.camera2.params.StreamConfigurationMap&gt; </span><br><span class="line">      SCALER_STREAM_CONFIGURATION_MAP =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;android.hardware.camera2.params.StreamConfigurationMap&gt;(</span><br><span class="line">        <span class="string">"android.scaler.streamConfigurationMap"</span>, </span><br><span class="line">        android.hardware.camera2.params.StreamConfigurationMap.class);</span><br><span class="line">  <span class="comment">// 传感器测试图案列表  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">int</span>[]&gt; SENSOR_AVAILABLE_TEST_PATTERN_MODES =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;<span class="keyword">int</span>[]&gt;(<span class="string">"android.sensor.availableTestPatternModes"</span>,</span><br><span class="line">      <span class="keyword">int</span>[].class);</span><br><span class="line">  <span class="comment">// 滤色器阵列马赛克通道的零光值（黑电平）  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;</span><br><span class="line">      android.hardware.camera2.params.BlackLevelPattern&gt; </span><br><span class="line">      SENSOR_BLACK_LEVEL_PATTERN =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;android.hardware.camera2.params.BlackLevelPattern&gt;(</span><br><span class="line">          <span class="string">"android.sensor.blackLevelPattern"</span>, </span><br><span class="line">          android.hardware.camera2.params.BlackLevelPattern.class);</span><br><span class="line">  <span class="comment">// 第一参考光源，校准变换矩阵  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;</span><br><span class="line">      android.hardware.camera2.params.ColorSpaceTransform&gt; </span><br><span class="line">      SENSOR_CALIBRATION_TRANSFORM1 =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;android.hardware.camera2.params.ColorSpaceTransform&gt;(</span><br><span class="line">          <span class="string">"android.sensor.calibrationTransform1"</span>, </span><br><span class="line">          android.hardware.camera2.params.ColorSpaceTransform.class);</span><br><span class="line">  <span class="comment">// 第二参考光源，校准变换矩阵 </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;</span><br><span class="line">      android.hardware.camera2.params.ColorSpaceTransform&gt; </span><br><span class="line">      SENSOR_CALIBRATION_TRANSFORM2 =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;android.hardware.camera2.params.ColorSpaceTransform&gt;(</span><br><span class="line">          <span class="string">"android.sensor.calibrationTransform2"</span>, </span><br><span class="line">          android.hardware.camera2.params.ColorSpaceTransform.class);</span><br><span class="line">  <span class="comment">// 第一参考光源，颜色转换矩阵  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;</span><br><span class="line">      android.hardware.camera2.params.ColorSpaceTransform&gt; </span><br><span class="line">      SENSOR_COLOR_TRANSFORM1 =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;android.hardware.camera2.params.ColorSpaceTransform&gt;(</span><br><span class="line">          <span class="string">"android.sensor.colorTransform1"</span>, </span><br><span class="line">          ndroid.hardware.camera2.params.ColorSpaceTransform.class);</span><br><span class="line">  <span class="comment">// 第二参考光源，颜色转换矩阵  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;</span><br><span class="line">      android.hardware.camera2.params.ColorSpaceTransform&gt; </span><br><span class="line">      SENSOR_COLOR_TRANSFORM2 =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;android.hardware.camera2.params.ColorSpaceTransform&gt;(</span><br><span class="line">          <span class="string">"android.sensor.colorTransform2"</span>, </span><br><span class="line">          android.hardware.camera2.params.ColorSpaceTransform.class);</span><br><span class="line">  <span class="comment">// 第一参考光源，使用 D50 白点的颜色转换矩阵  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;</span><br><span class="line">      android.hardware.camera2.params.ColorSpaceTransform&gt; </span><br><span class="line">      SENSOR_FORWARD_MATRIX1 =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;android.hardware.camera2.params.ColorSpaceTransform&gt;(</span><br><span class="line">          <span class="string">"android.sensor.forwardMatrix1"</span>, </span><br><span class="line">          android.hardware.camera2.params.ColorSpaceTransform.class);</span><br><span class="line">  <span class="comment">// 第二参考光源，使用 D50 白点的颜色转换矩阵</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;</span><br><span class="line">      android.hardware.camera2.params.ColorSpaceTransform&gt; </span><br><span class="line">      SENSOR_FORWARD_MATRIX2 =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;android.hardware.camera2.params.ColorSpaceTransform&gt;(</span><br><span class="line">          <span class="string">"android.sensor.forwardMatrix2"</span>, </span><br><span class="line">          android.hardware.camera2.params.ColorSpaceTransform.class);    </span><br><span class="line">  <span class="comment">// 使用几何失真校准的矩形大小  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;android.graphics.Rect&gt; </span><br><span class="line">      SENSOR_INFO_ACTIVE_ARRAY_SIZE =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;android.graphics.Rect&gt;(</span><br><span class="line">          <span class="string">"android.sensor.info.activeArraySize"</span>, </span><br><span class="line">          android.graphics.Rect.class);</span><br><span class="line">  <span class="comment">// 滤色镜排布  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; SENSOR_INFO_COLOR_FILTER_ARRANGEMENT =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.sensor.info.colorFilterArrangement"</span>, </span><br><span class="line">          <span class="keyword">int</span>.class);</span><br><span class="line">  <span class="comment">// 图像曝光时间范围</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;android.util.Range&lt;Long&gt;&gt; </span><br><span class="line">      SENSOR_INFO_EXPOSURE_TIME_RANGE =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;android.util.Range&lt;Long&gt;&gt;(</span><br><span class="line">          <span class="string">"android.sensor.info.exposureTimeRange"</span>, </span><br><span class="line">          <span class="keyword">new</span> TypeReference&lt;android.util.Range&lt;Long&gt;&gt;() &#123;&#123; &#125;&#125;);</span><br><span class="line">  <span class="comment">// 摄像头原始图像输出是否受镜头阴影矫正  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Boolean&gt; SENSOR_INFO_LENS_SHADING_APPLIED =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;Boolean&gt;(<span class="string">"android.sensor.info.lensShadingApplied"</span>,</span><br><span class="line">          <span class="keyword">boolean</span>.class);</span><br><span class="line">  <span class="comment">// 最大帧间隔（最小帧率）  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Long&gt; SENSOR_INFO_MAX_FRAME_DURATION =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;Long&gt;(<span class="string">"android.sensor.info.maxFrameDuration"</span>, </span><br><span class="line">          <span class="keyword">long</span>.class);</span><br><span class="line">  <span class="comment">// 全像素数组的物理尺寸  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;android.util.SizeF&gt; SENSOR_INFO_PHYSICAL_SIZE =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;android.util.SizeF&gt;(<span class="string">"android.sensor.info.physicalSize"</span>,</span><br><span class="line">          android.util.SizeF.class);</span><br><span class="line">  <span class="comment">// 全像素数组的维度，包括黑色校准像素  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;android.util.Size&gt; SENSOR_INFO_PIXEL_ARRAY_SIZE=</span><br><span class="line">      <span class="keyword">new</span> Key&lt;android.util.Size&gt;(<span class="string">"android.sensor.info.pixelArraySize"</span>,</span><br><span class="line">      android.util.Size.class);</span><br><span class="line">  <span class="comment">// 几何失真校准的有效区域  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;android.graphics.Rect&gt; </span><br><span class="line">      SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;android.graphics.Rect&gt;(</span><br><span class="line">          <span class="string">"android.sensor.info.preCorrectionActiveArraySize"</span>,</span><br><span class="line">          android.graphics.Rect.class);</span><br><span class="line">  <span class="comment">// ISO 感光度范围  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;android.util.Range&lt;Integer&gt;&gt; </span><br><span class="line">      SENSOR_INFO_SENSITIVITY_RANGE =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;android.util.Range&lt;Integer&gt;&gt;(</span><br><span class="line">          <span class="string">"android.sensor.info.sensitivityRange"</span>, </span><br><span class="line">          <span class="keyword">new</span> TypeReference&lt;android.util.Range&lt;Integer&gt;&gt;() &#123;&#123; &#125;&#125;);</span><br><span class="line">  <span class="comment">// 传感器开始捕获时间戳的时基源</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; SENSOR_INFO_TIMESTAMP_SOURCE =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.sensor.info.timestampSource"</span>, </span><br><span class="line">          <span class="keyword">int</span>.class);</span><br><span class="line">  <span class="comment">// 传感器最大输出的原始数值</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; SENSOR_INFO_WHITE_LEVEL =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.sensor.info.whiteLevel"</span>, </span><br><span class="line">          <span class="keyword">int</span>.class);</span><br><span class="line">  <span class="comment">// 通过模拟增益获得的最大灵敏度 </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; SENSOR_MAX_ANALOG_SENSITIVITY =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.sensor.maxAnalogSensitivity"</span>, </span><br><span class="line">          <span class="keyword">int</span>.class);    </span><br><span class="line">  <span class="comment">// 传感器光学屏蔽的黑色像素不相交区域  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;android.graphics.Rect[]&gt; </span><br><span class="line">      SENSOR_OPTICAL_BLACK_REGIONS =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;android.graphics.Rect[]&gt;(</span><br><span class="line">          <span class="string">"android.sensor.opticalBlackRegions"</span>, </span><br><span class="line">          android.graphics.Rect[].class);</span><br><span class="line">  <span class="comment">// 输出图像与屏幕垂直所需要的顺时针角度  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; SENSOR_ORIENTATION =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.sensor.orientation"</span>, <span class="keyword">int</span>.class);</span><br><span class="line">  <span class="comment">// 标准参考光源 1  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; SENSOR_REFERENCE_ILLUMINANT1 =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.sensor.referenceIlluminant1"</span>, <span class="keyword">int</span>.class);</span><br><span class="line">  <span class="comment">// 标准参考光源 2  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Byte&gt; SENSOR_REFERENCE_ILLUMINANT2 =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;Byte&gt;(<span class="string">"android.sensor.referenceIlluminant2"</span>, <span class="keyword">byte</span>.class);</span><br><span class="line">  <span class="comment">// 镜头均匀性，阴影校准模式  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">int</span>[]&gt; SHADING_AVAILABLE_MODES =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;<span class="keyword">int</span>[]&gt;(<span class="string">"android.shading.availableModes"</span>, <span class="keyword">int</span>[].class);</span><br><span class="line">  <span class="comment">// 人脸识别模式模式  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">int</span>[]&gt; </span><br><span class="line">      STATISTICS_INFO_AVAILABLE_FACE_DETECT_MODES =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;<span class="keyword">int</span>[]&gt;(<span class="string">"android.statistics.info.availableFaceDetectModes"</span>,</span><br><span class="line">      <span class="keyword">int</span>[].class);</span><br><span class="line">  <span class="comment">// 热点映射模式  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">boolean</span>[]&gt; </span><br><span class="line">      STATISTICS_INFO_AVAILABLE_HOT_PIXEL_MAP_MODES =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;<span class="keyword">boolean</span>[]&gt;(</span><br><span class="line">          <span class="string">"android.statistics.info.availableHotPixelMapModes"</span>, </span><br><span class="line">          <span class="keyword">boolean</span>[].class);</span><br><span class="line">  <span class="comment">// 镜头阴影校准映表模式  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">int</span>[]&gt; </span><br><span class="line">      STATISTICS_INFO_AVAILABLE_LENS_SHADING_MAP_MODES =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;<span class="keyword">int</span>[]&gt;(</span><br><span class="line">          <span class="string">"android.statistics.info.availableLensShadingMapModes"</span>,</span><br><span class="line">          <span class="keyword">int</span>[].class);</span><br><span class="line">  <span class="comment">// 光学防抖位置数据模式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">int</span>[]&gt; STATISTICS_INFO_AVAILABLE_OIS_DATA_MODES=.;</span><br><span class="line">  <span class="comment">// 同时可检测的最大人脸数  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; STATISTICS_INFO_MAX_FACE_COUNT =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.statistics.info.maxFaceCount"</span>, </span><br><span class="line">          <span class="keyword">int</span>.class);</span><br><span class="line">  <span class="comment">// 最大同步延迟数  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; SYNC_MAX_LATENCY =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.sync.maxLatency"</span>, <span class="keyword">int</span>.class);</span><br><span class="line">  <span class="comment">// 色调映射模式  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">int</span>[]&gt; TONEMAP_AVAILABLE_TONE_MAP_MODES =</span><br><span class="line">          <span class="keyword">new</span> Key&lt;<span class="keyword">int</span>[]&gt;(<span class="string">"android.tonemap.availableToneMapModes"</span>, </span><br><span class="line">          <span class="keyword">int</span>[].class);</span><br><span class="line">  <span class="comment">// 色调映射曲线支持的最大数量点  </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; TONEMAP_MAX_CURVE_POINTS =</span><br><span class="line">      <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.tonemap.maxCurvePoints"</span>, <span class="keyword">int</span>.class);</span><br></pre></td></tr></table></figure>

<h3 id="API-方法-4"><a href="#API-方法-4" class="headerlink" title="API 方法"></a><code>API</code> 方法</h3><p><code>CameraCharacteristics</code> 支持的方法：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">CameraCharacteristics</span> </span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">CameraMetadata</span>&lt;<span class="title">CameraCharacteristics</span>.<span class="title">Key</span>&lt;?&gt;&gt; </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CameraMetadataNative mProperties;</span><br><span class="line">    <span class="keyword">private</span> List&lt;CameraCharacteristics.Key&lt;?&gt;&gt; mKeys;</span><br><span class="line">    <span class="keyword">private</span> List&lt;CaptureRequest.Key&lt;?&gt;&gt; mAvailableRequestKeys;</span><br><span class="line">    <span class="keyword">private</span> List&lt;CaptureResult.Key&lt;?&gt;&gt; mAvailableResultKeys;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">get</span><span class="params">(Key&lt;T&gt; key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mProperties.get(key);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取相机支持的请求列表  </span></span><br><span class="line">    <span class="keyword">public</span> List&lt;CaptureRequest.Key&lt;?&gt;&gt; getAvailableCaptureRequestKeys() &#123;</span><br><span class="line">        <span class="keyword">if</span> (mAvailableRequestKeys == <span class="keyword">null</span>) &#123;</span><br><span class="line">            Object crKey = CaptureRequest.Key.class;</span><br><span class="line">            Class&lt;CaptureRequest.Key&lt;?&gt;&gt; crKeyTyped </span><br><span class="line">                = (Class&lt;CaptureRequest.Key&lt;?&gt;&gt;)crKey;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span>[] filterTags = get(REQUEST_AVAILABLE_REQUEST_KEYS);</span><br><span class="line">            <span class="keyword">if</span> (filterTags == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError(<span class="string">"..."</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            mAvailableRequestKeys = getAvailableKeyList(</span><br><span class="line">                CaptureRequest.class, crKeyTyped, filterTags);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mAvailableRequestKeys;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取相机支持的结果列表  </span></span><br><span class="line">    <span class="keyword">public</span> List&lt;CaptureResult.Key&lt;?&gt;&gt; getAvailableCaptureResultKeys() &#123;</span><br><span class="line">        <span class="keyword">if</span> (mAvailableResultKeys == <span class="keyword">null</span>) &#123;</span><br><span class="line">            Object crKey = CaptureResult.Key.class;</span><br><span class="line">            Class&lt;CaptureResult.Key&lt;?&gt;&gt; crKeyTyped </span><br><span class="line">                = (Class&lt;CaptureResult.Key&lt;?&gt;&gt;)crKey;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span>[] filterTags = get(REQUEST_AVAILABLE_RESULT_KEYS);</span><br><span class="line">            <span class="keyword">if</span> (filterTags == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError(<span class="string">"..."</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            mAvailableResultKeys = getAvailableKeyList(</span><br><span class="line">                CaptureResult.class, crKeyTyped, filterTags);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mAvailableResultKeys;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// getAvailableCaptureRequestKeys 的子集</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;CaptureRequest.Key&lt;?&gt;&gt; </span><br><span class="line">        getAvailablePhysicalCameraRequestKeys()&#123;...&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//  getAvailableCaptureRequestKeys 的子集  </span></span><br><span class="line">    <span class="keyword">public</span> List&lt;CaptureRequest.Key&lt;?&gt;&gt; </span><br><span class="line">        getAvailableSessionKeys() &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;Key&lt;?&gt;&gt; getKeys() &#123;</span><br><span class="line">        <span class="comment">// List of keys is immutable; </span></span><br><span class="line">        <span class="comment">// cache the results after we calculate them</span></span><br><span class="line">        <span class="keyword">if</span> (mKeys != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> mKeys;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span>[] filterTags = get(REQUEST_AVAILABLE_CHARACTERISTICS_KEYS);</span><br><span class="line">        <span class="keyword">if</span> (filterTags == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError(<span class="string">"..."</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        mKeys = Collections.unmodifiableList(</span><br><span class="line">                getKeys(getClass(), getKeyClass(), <span class="keyword">this</span>, filterTags));</span><br><span class="line">        <span class="keyword">return</span> mKeys;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">Set&lt;String&gt; <span class="title">getPhysicalCameraIds</span><span class="params">()</span></span>&#123;...&#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="CaptureRequest"><a href="#CaptureRequest" class="headerlink" title="CaptureRequest"></a><code>CaptureRequest</code></h2><p><code>CaptureRequest</code> 继承了 <code>CameraMetadata</code> ；表示从 <code>CameraDevice</code> 获取捕获数据的请求，包含对 <code>CameraDevice</code> 的参数设置，算法控制，输出缓冲区等等。  </p>
<ul>
<li>创建实例<br>由 <code>CameraDevice.createCaptureRequest</code> 返回的 <code>CaptureRequest.Builder</code> 来创建实例。  </li>
<li>请求<br>由 <code>CameraCaptureSession.capture, CameraCaptureSession.setRepeatingRequest</code> 向 <code>CameraDevice</code> 发出请求。  </li>
</ul>
<h3 id="Key-常量-1"><a href="#Key-常量-1" class="headerlink" title="Key 常量"></a><code>Key</code> 常量</h3><p><code>CaptureRequest</code> 支持的 <code>Key</code> 常量及其含义，这些值都是 <code>system/media/camera/docs</code> 自动生成的：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 黑电平补偿是否锁定当前值；对于某些参数（曝光时间）的改变需要重置黑电平  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Boolean&gt; BLACK_LEVEL_LOCK =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Boolean&gt;(<span class="string">"android.blackLevel.lock"</span>, <span class="keyword">boolean</span>.class);</span><br><span class="line"><span class="comment">// 色差校准算法的操作模式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; COLOR_CORRECTION_ABERRATION_MODE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.colorCorrection.aberrationMode"</span></span><br><span class="line">        , <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 适用于 Bayer 原色通道的白平衡增益</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> </span><br><span class="line">    Key&lt;android.hardware.camera2.params.RggbChannelVector&gt; </span><br><span class="line">    COLOR_CORRECTION_GAINS =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;android.hardware.camera2.params.RggbChannelVector&gt;</span><br><span class="line">        (<span class="string">"android.colorCorrection.gains"</span>, </span><br><span class="line">        android.hardware.camera2.params.RggbChannelVector.class);</span><br><span class="line"><span class="comment">// 原始颜色转换为 sRGB 时的颜色校准模式；当 AWE 开启时，该值不会生效</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; COLOR_CORRECTION_MODE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.colorCorrection.mode"</span>, <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 颜色校准转换矩阵</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> </span><br><span class="line">    Key&lt;android.hardware.camera2.params.ColorSpaceTransform&gt; </span><br><span class="line">    COLOR_CORRECTION_TRANSFORM =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;android.hardware.camera2.params.ColorSpaceTransform&gt;(</span><br><span class="line">        <span class="string">"android.colorCorrection.transform"</span>, </span><br><span class="line">        android.hardware.camera2.params.ColorSpaceTransform.class);</span><br><span class="line"><span class="comment">// 工频干扰模式，自动曝光时需要设置反馈补偿</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; CONTROL_AE_ANTIBANDING_MODE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.control.aeAntibandingMode"</span>, </span><br><span class="line">        <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 调整自动曝光图像亮度的补偿值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; CONTROL_AE_EXPOSURE_COMPENSATION =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.control.aeExposureCompensation"</span>, </span><br><span class="line">        <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 自动曝光当前是否锁定</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Boolean&gt; CONTROL_AE_LOCK =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Boolean&gt;(<span class="string">"android.control.aeLock"</span>, <span class="keyword">boolean</span>.class);</span><br><span class="line"><span class="comment">// 自动曝光的控制模式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; CONTROL_AE_MODE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.control.aeMode"</span>, <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 自动曝光测光序列开关</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; CONTROL_AE_PRECAPTURE_TRIGGER =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.control.aePrecaptureTrigger"</span>, </span><br><span class="line">        <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 自动曝光测光区域列表</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> </span><br><span class="line">    Key&lt;android.hardware.camera2.params.MeteringRectangle[]&gt; </span><br><span class="line">    CONTROL_AE_REGIONS =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;android.hardware.camera2.params.MeteringRectangle[]&gt;(</span><br><span class="line">        <span class="string">"android.control.aeRegions"</span>, </span><br><span class="line">        android.hardware.camera2.params.MeteringRectangle[].class);</span><br><span class="line"><span class="comment">// 自动曝光调整帧率来保持良好的曝光范围</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;android.util.Range&lt;Integer&gt;&gt; </span><br><span class="line">    CONTROL_AE_TARGET_FPS_RANGE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;android.util.Range&lt;Integer&gt;&gt;(</span><br><span class="line">        <span class="string">"android.control.aeTargetFpsRange"</span>, </span><br><span class="line">        <span class="keyword">new</span> TypeReference&lt;android.util.Range&lt;Integer&gt;&gt;() &#123;&#123; &#125;&#125;);</span><br><span class="line"><span class="comment">// 自动对焦模式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; CONTROL_AF_MODE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.control.afMode"</span>, <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 自动对焦计量区域列表</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> </span><br><span class="line">    Key&lt;android.hardware.camera2.params.MeteringRectangle[]&gt; </span><br><span class="line">    CONTROL_AF_REGIONS =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;android.hardware.camera2.params.MeteringRectangle[]&gt;(</span><br><span class="line">        <span class="string">"android.control.afRegions"</span>, </span><br><span class="line">        android.hardware.camera2.params.MeteringRectangle[].class);</span><br><span class="line"><span class="comment">// 自动对焦开关</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; CONTROL_AF_TRIGGER =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.control.afTrigger"</span>, <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 自动白平衡是否锁定</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Boolean&gt; CONTROL_AWB_LOCK =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Boolean&gt;(<span class="string">"android.control.awbLock"</span>, <span class="keyword">boolean</span>.class);</span><br><span class="line"><span class="comment">// 自动白平衡的模式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; CONTROL_AWB_MODE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.control.awbMode"</span>, <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 自动白平衡，光源估计的测量区域列表</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> </span><br><span class="line">    Key&lt;android.hardware.camera2.params.MeteringRectangle[]&gt; </span><br><span class="line">    CONTROL_AWB_REGIONS =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;android.hardware.camera2.params.MeteringRectangle[]&gt;(</span><br><span class="line">        <span class="string">"android.control.awbRegions"</span>, </span><br><span class="line">        android.hardware.camera2.params.MeteringRectangle[].class);</span><br><span class="line"><span class="comment">// 设置捕获图像信息时的控制意图，比如 3A 算法等</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; CONTROL_CAPTURE_INTENT =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.control.captureIntent"</span>, <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 设置颜色效果模式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; CONTROL_EFFECT_MODE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.control.effectMode"</span>, <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 是否开启 ZSL</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Boolean&gt; CONTROL_ENABLE_ZSL =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Boolean&gt;(<span class="string">"android.control.enableZsl"</span>, <span class="keyword">boolean</span>.class);</span><br><span class="line"><span class="comment">// 设置控制模式，手动、自动等</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; CONTROL_MODE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.control.mode"</span>, <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 设置传感器捕获数据后，灵敏度增强</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; CONTROL_POST_RAW_SENSITIVITY_BOOST =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.control.postRawSensitivityBoost"</span>, </span><br><span class="line">        <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 设置场景模式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; CONTROL_SCENE_MODE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.control.sceneMode"</span>, <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 设置录像防抖模式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; CONTROL_VIDEO_STABILIZATION_MODE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.control.videoStabilizationMode"</span>, </span><br><span class="line">        <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 设置失真校准模式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; DISTORTION_CORRECTION_MODE = ...;</span><br><span class="line"><span class="comment">// 设置边缘增强模式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; EDGE_MODE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.edge.mode"</span>, <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 设置闪光灯模式，手电筒等</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; FLASH_MODE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.flash.mode"</span>, <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 设置热点校正模式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; HOT_PIXEL_MODE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.hotPixel.mode"</span>, <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 生成图像的 GPS 元数据时，使用位置信息</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;android.location.Location&gt; JPEG_GPS_LOCATION =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;android.location.Location&gt;(<span class="string">"android.jpeg.gpsLocation"</span>, </span><br><span class="line">        android.location.Location.class);</span><br><span class="line"><span class="comment">// JPEG 图像的旋转方向</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; JPEG_ORIENTATION =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.jpeg.orientation"</span>, <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// JPEG 图像的质量，典型值为 85-95 </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Byte&gt; JPEG_QUALITY =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Byte&gt;(<span class="string">"android.jpeg.quality"</span>, <span class="keyword">byte</span>.class);</span><br><span class="line"><span class="comment">// JPEG 缩略图的质量 1-100</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Byte&gt; JPEG_THUMBNAIL_QUALITY =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Byte&gt;(<span class="string">"android.jpeg.thumbnailQuality"</span>, <span class="keyword">byte</span>.class);</span><br><span class="line"><span class="comment">// JPEG 缩略图分辨率</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;android.util.Size&gt; JPEG_THUMBNAIL_SIZE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;android.util.Size&gt;(<span class="string">"android.jpeg.thumbnailSize"</span>, </span><br><span class="line">        android.util.Size.class);</span><br><span class="line"><span class="comment">// 镜头光圈大小</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Float&gt; LENS_APERTURE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Float&gt;(<span class="string">"android.lens.aperture"</span>, <span class="keyword">float</span>.class);</span><br><span class="line"><span class="comment">// 镜头滤光片密度</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Float&gt; LENS_FILTER_DENSITY =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Float&gt;(<span class="string">"android.lens.filterDensity"</span>, <span class="keyword">float</span>.class);</span><br><span class="line"><span class="comment">// 镜头光学变焦焦距</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Float&gt; LENS_FOCAL_LENGTH =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Float&gt;(<span class="string">"android.lens.focalLength"</span>, <span class="keyword">float</span>.class);</span><br><span class="line"><span class="comment">// 镜头到最清晰焦点的距离</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Float&gt; LENS_FOCUS_DISTANCE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Float&gt;(<span class="string">"android.lens.focusDistance"</span>, <span class="keyword">float</span>.class);</span><br><span class="line"><span class="comment">// 设置镜头光学防抖模式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; LENS_OPTICAL_STABILIZATION_MODE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.lens.opticalStabilizationMode"</span>, </span><br><span class="line">        <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 设置降噪模式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; NOISE_REDUCTION_MODE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.noiseReduction.mode"</span>, <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 重复处理前，原始帧的曝光因子</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Float&gt; REPROCESS_EFFECTIVE_EXPOSURE_FACTOR =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Float&gt;(<span class="string">"android.reprocess.effectiveExposureFactor"</span>, </span><br><span class="line">        <span class="keyword">float</span>.class);</span><br><span class="line"><span class="comment">// 设置裁剪区域，可用于数字变焦</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;android.graphics.Rect&gt; SCALER_CROP_REGION =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;android.graphics.Rect&gt;(<span class="string">"android.scaler.cropRegion"</span>, </span><br><span class="line">        android.graphics.Rect.class);</span><br><span class="line"><span class="comment">// 传感器自动曝光时间</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Long&gt; SENSOR_EXPOSURE_TIME =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Long&gt;(<span class="string">"android.sensor.exposureTime"</span>, <span class="keyword">long</span>.class);</span><br><span class="line"><span class="comment">// 从帧曝光开始到下一帧曝光的间隔时间</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Long&gt; SENSOR_FRAME_DURATION =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Long&gt;(<span class="string">"android.sensor.frameDuration"</span>, <span class="keyword">long</span>.class);</span><br><span class="line"><span class="comment">// 传感器 ISO 感光度</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; SENSOR_SENSITIVITY =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.sensor.sensitivity"</span>, <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 传感器测试模式序列数据 [R, G_even, G_odd, B]</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">int</span>[]&gt; SENSOR_TEST_PATTERN_DATA =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;<span class="keyword">int</span>[]&gt;(<span class="string">"android.sensor.testPatternData"</span>, <span class="keyword">int</span>[].class);</span><br><span class="line"><span class="comment">// 传感器测试模图案模式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; SENSOR_TEST_PATTERN_MODE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.sensor.testPatternMode"</span>, <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 镜头阴影校正模式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; SHADING_MODE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.shading.mode"</span>, <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 人脸检测模式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; STATISTICS_FACE_DETECT_MODE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.statistics.faceDetectMode"</span>, </span><br><span class="line">        <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 热点映射模式开关</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Boolean&gt; STATISTICS_HOT_PIXEL_MAP_MODE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Boolean&gt;(<span class="string">"android.statistics.hotPixelMapMode"</span>, </span><br><span class="line">        <span class="keyword">boolean</span>.class);</span><br><span class="line"><span class="comment">// 镜头阴影校正映射开关</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; STATISTICS_LENS_SHADING_MAP_MODE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.statistics.lensShadingMapMode"</span>, </span><br><span class="line">        <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 光学防抖数据模式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; STATISTICS_OIS_DATA_MODE = ...;</span><br><span class="line"><span class="comment">// 色调映射曲线</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;android.hardware.camera2.params.TonemapCurve&gt;</span><br><span class="line">    TONEMAP_CURVE = </span><br><span class="line">    <span class="keyword">new</span> Key&lt;android.hardware.camera2.params.TonemapCurve&gt;(</span><br><span class="line">    <span class="string">"android.tonemap.curve"</span>, </span><br><span class="line">    android.hardware.camera2.params.TonemapCurve.class);</span><br><span class="line"><span class="comment">// 色调映射曲线伽马值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Float&gt; TONEMAP_GAMMA =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Float&gt;(<span class="string">"android.tonemap.gamma"</span>, <span class="keyword">float</span>.class);</span><br><span class="line"><span class="comment">// 色调映射模式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; TONEMAP_MODE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.tonemap.mode"</span>, <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 色调映射预设曲线</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; TONEMAP_PRESET_CURVE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.tonemap.presetCurve"</span>, <span class="keyword">int</span>.class);</span><br></pre></td></tr></table></figure>

<h3 id="API-方法-5"><a href="#API-方法-5" class="headerlink" title="API 方法"></a><code>API</code> 方法</h3><p><code>CaptureRequest</code> 中 <code>API</code> 简介：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">CaptureRequest</span> </span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">CameraMetadata</span>&lt;<span class="title">CaptureRequest</span>.<span class="title">Key</span>&lt;?&gt;&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">Parcelable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> HashSet&lt;Surface&gt; mSurfaceSet;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CameraMetadataNative mSettings;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mIsReprocess;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mIsPartOfCHSRequestList = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mReprocessableSessionId;</span><br><span class="line">    <span class="keyword">private</span> Object mUserTag;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// 获取键对应的值</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">get</span><span class="params">(Key&lt;T&gt; key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mSettings.get(key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获取所有的键值列表</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Key&lt;?&gt;&gt; getKeys() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getKeys();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 当前请求的 tag 信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getTag</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mUserTag;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 是否是在重新处理请求</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isReprocess</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mIsReprocess;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Builder-内部类"><a href="#Builder-内部类" class="headerlink" title="Builder 内部类"></a><code>Builder</code> 内部类</h3><p><code>CaptureRequest.Builder</code> 内部类，建造者模式，用于创建 <code>CaptureRequest</code> 实例。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CaptureRequest mRequest;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Builder</span><span class="params">(CameraMetadataNative template, <span class="keyword">boolean</span> reprocess,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">int</span> reprocessableSessionId)</span> </span>&#123;</span><br><span class="line">        mRequest = <span class="keyword">new</span> CaptureRequest(template, reprocess, </span><br><span class="line">            reprocessableSessionId);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 添加输出目标</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addTarget</span><span class="params">(@NonNull Surface outputTarget)</span> </span>&#123;</span><br><span class="line">        mRequest.mSurfaceSet.add(outputTarget);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeTarget</span><span class="params">(@NonNull Surface outputTarget)</span> </span>&#123;</span><br><span class="line">        mRequest.mSurfaceSet.remove(outputTarget);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 设置键值对</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(@NonNull Key&lt;T&gt; key, T value)</span> </span>&#123;</span><br><span class="line">        mRequest.mSettings.set(key, value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">get</span><span class="params">(Key&lt;T&gt; key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mRequest.mSettings.get(key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTag</span><span class="params">(@Nullable Object tag)</span> </span>&#123;</span><br><span class="line">        mRequest.mUserTag = tag;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> CaptureRequest <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CaptureRequest(mRequest);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mRequest.mSettings.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getPhysicalCameraKey</span> <span class="params">(Key&lt;T&gt; key, </span></span></span><br><span class="line"><span class="function"><span class="params">                String physicalCameraId)</span></span>&#123;...&#125;</span><br><span class="line">    <span class="keyword">public</span> CaptureRequest.<span class="function">Builder <span class="title">setPhysicalCameraKey</span> <span class="params">(Key&lt;T&gt; key, </span></span></span><br><span class="line"><span class="function"><span class="params">                T value,  String physicalCameraId)</span></span>&#123;...&#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Key-内部类"><a href="#Key-内部类" class="headerlink" title="Key 内部类"></a><code>Key</code> 内部类</h3><p><code>CaptureRequest.Key&lt;T&gt;</code> 内部类，用于设置参数时的 <code>Key</code> 值。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Key</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CameraMetadataNative.Key&lt;T&gt; mKey;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Key</span><span class="params">(String name, Class&lt;T&gt; type, <span class="keyword">long</span> vendorId)</span> </span>&#123;</span><br><span class="line">        mKey = <span class="keyword">new</span> CameraMetadataNative.Key&lt;T&gt;(name, type, vendorId);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// 获取键值名称</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mKey.getName();</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="CaptureResult"><a href="#CaptureResult" class="headerlink" title="CaptureResult"></a><code>CaptureResult</code></h2><p><code>CaptureResult</code> 继承了 <code>CameraMetadata</code> ；表示从 <code>CameraDevice</code> 获取到数据的结果子集；包含捕获硬件（传感器，镜头，闪存），控制算法和输出缓冲区的最终配置等的子集；<code>CaptureResult</code> 对象实例是不可变的。  </p>
<h3 id="Key-常量-2"><a href="#Key-常量-2" class="headerlink" title="Key 常量"></a><code>Key</code> 常量</h3><p>通过对比代码 <code>CaptureRequest, CaptureResult</code> 两份代码大部分都相同，特别是 <code>Key</code> 常量的定义（都是在 <code>system/media/camera/docs</code> 中通过脚本生成），<code>CaptureResult</code> 仅仅是新增了几个常量：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">// 自动曝光算法当前状态：搜索，锁定，转换等等</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; CONTROL_AE_STATE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.control.aeState"</span>, <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 自动对焦算法当前状态：激活，扫描，锁定等等</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; CONTROL_AF_STATE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.control.afState"</span>, <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 白平衡算法当前状态：激活，搜索，转换，锁定等</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; CONTROL_AWB_STATE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.control.awbState"</span>, <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 闪光灯当前状态：充电、闪光、装备好等</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; FLASH_STATE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.flash.state"</span>, <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 景深距离范围</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;android.util.Pair&lt;Float,Float&gt;&gt; </span><br><span class="line">    LENS_FOCUS_RANGE = <span class="keyword">new</span> Key&lt;android.util.Pair&lt;Float,Float&gt;&gt;(</span><br><span class="line">    <span class="string">"android.lens.focusRange"</span>, </span><br><span class="line">    <span class="keyword">new</span> TypeReference&lt;android.util.Pair&lt;Float,Float&gt;&gt;() &#123;&#123; &#125;&#125;);</span><br><span class="line"><span class="comment">// 镜头当前状态：移动、平稳</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; LENS_STATE =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.lens.state"</span>, <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 镜头坐标体系的方向</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">float</span>[]&gt; LENS_POSE_ROTATION =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;<span class="keyword">float</span>[]&gt;(<span class="string">"android.lens.poseRotation"</span>, <span class="keyword">float</span>[].class);</span><br><span class="line"><span class="comment">// 镜头光学中心位置</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">float</span>[]&gt; LENS_POSE_TRANSLATION =</span><br><span class="line">    <span class="keyword">new</span> Key&lt;<span class="keyword">float</span>[]&gt;(<span class="string">"android.lens.poseTranslation"</span>, <span class="keyword">float</span>[].class);</span><br><span class="line"><span class="comment">// 镜头固有的校准参数</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">float</span>[]&gt; LENS_INTRINSIC_CALIBRATION =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;<span class="keyword">float</span>[]&gt;(<span class="string">"android.lens.intrinsicCalibration"</span>, </span><br><span class="line">        <span class="keyword">float</span>[].class);</span><br><span class="line"><span class="comment">// 降级，使用 LENS_DISTORTION 代替</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">float</span>[]&gt; LENS_RADIAL_DISTORTION =</span><br><span class="line">    <span class="keyword">new</span> Key&lt;<span class="keyword">float</span>[]&gt;(<span class="string">"android.lens.radialDistortion"</span>, <span class="keyword">float</span>[].class);</span><br><span class="line"><span class="comment">// 请求的管道深度</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Byte&gt; REQUEST_PIPELINE_DEPTH =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Byte&gt;(<span class="string">"android.request.pipelineDepth"</span>, <span class="keyword">byte</span>.class);</span><br><span class="line"><span class="comment">// 返回传感器时间戳</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Long&gt; SENSOR_TIMESTAMP =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Long&gt;(<span class="string">"android.sensor.timestamp"</span>, <span class="keyword">long</span>.class);</span><br><span class="line"><span class="comment">// 传感器色彩空间中估计的中性色</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Rational[]&gt; SENSOR_NEUTRAL_COLOR_POINT =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Rational[]&gt;(<span class="string">"android.sensor.neutralColorPoint"</span>, </span><br><span class="line">        Rational[].class);</span><br><span class="line"><span class="comment">// 每个 CFA 马赛克通道的噪声模型系数</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;android.util.Pair&lt;Double,Double&gt;[]&gt; </span><br><span class="line">    SENSOR_NOISE_PROFILE = <span class="keyword">new</span> Key&lt;android.util.Pair&lt;Double,Double&gt;[]&gt;(</span><br><span class="line">    <span class="string">"android.sensor.noiseProfile"</span>, </span><br><span class="line">    <span class="keyword">new</span> TypeReference&lt;android.util.Pair&lt;Double,Double&gt;[]&gt;() &#123;&#123; &#125;&#125;);</span><br><span class="line"><span class="comment">// Bayer 阵列中绿色通道最差分割的估计值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Float&gt; SENSOR_GREEN_SPLIT =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Float&gt;(<span class="string">"android.sensor.greenSplit"</span>, <span class="keyword">float</span>.class);</span><br><span class="line"><span class="comment">// 第一行到最后一行曝光的时间偏差</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Long&gt; SENSOR_ROLLING_SHUTTER_SKEW =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Long&gt;(<span class="string">"android.sensor.rollingShutterSkew"</span>, <span class="keyword">long</span>.class);</span><br><span class="line"><span class="comment">// 每个滤色器排列 CFA 马赛克通道的每帧动态黑电平偏移</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">float</span>[]&gt; SENSOR_DYNAMIC_BLACK_LEVEL =</span><br><span class="line">    <span class="keyword">new</span> Key&lt;<span class="keyword">float</span>[]&gt;(<span class="string">"android.sensor.dynamicBlackLevel"</span>, <span class="keyword">float</span>[].class);</span><br><span class="line"><span class="comment">// 每个滤色器排列 CFA 马赛克通道的每帧动态白电平偏移</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; SENSOR_DYNAMIC_WHITE_LEVEL =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.sensor.dynamicWhiteLevel"</span>, <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;<span class="keyword">int</span>[]&gt; STATISTICS_FACE_IDS =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;<span class="keyword">int</span>[]&gt;(<span class="string">"android.statistics.faceIds"</span>, <span class="keyword">int</span>[].class);</span><br><span class="line"><span class="comment">// 检测到的人脸列表</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;android.hardware.camera2.params.Face[]&gt; </span><br><span class="line">    STATISTICS_FACES = <span class="keyword">new</span> Key&lt;android.hardware.camera2.params.Face[]&gt;(</span><br><span class="line">    <span class="string">"android.statistics.faces"</span>, </span><br><span class="line">    android.hardware.camera2.params.Face[].class);</span><br><span class="line"><span class="comment">// 镜头阴影校正映射图</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;android.hardware.camera2.params.LensShadingMap&gt; </span><br><span class="line">    STATISTICS_LENS_SHADING_CORRECTION_MAP =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;android.hardware.camera2.params.LensShadingMap&gt;(</span><br><span class="line">        <span class="string">"android.statistics.lensShadingCorrectionMap"</span>, </span><br><span class="line">        android.hardware.camera2.params.LensShadingMap.class);</span><br><span class="line"><span class="comment">// 传感器估计的灯源照明频率</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;Integer&gt; STATISTICS_SCENE_FLICKER =</span><br><span class="line">        <span class="keyword">new</span> Key&lt;Integer&gt;(<span class="string">"android.statistics.sceneFlicker"</span>, <span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">// 热点映射区域</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Key&lt;android.graphics.Point[]&gt; </span><br><span class="line">    STATISTICS_HOT_PIXEL_MAP = <span class="keyword">new</span> Key&lt;android.graphics.Point[]&gt;(</span><br><span class="line">    <span class="string">"android.statistics.hotPixelMap"</span>, android.graphics.Point[].class);</span><br></pre></td></tr></table></figure>

<h3 id="API-方法-6"><a href="#API-方法-6" class="headerlink" title="API 方法"></a><code>API</code> 方法</h3><p><code>CaptureResult</code> 中 <code>API</code> 简介：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CaptureResult</span> <span class="keyword">extends</span> <span class="title">CameraMetadata</span>&lt;<span class="title">CaptureResult</span>.<span class="title">Key</span>&lt;?&gt;&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CameraMetadataNative mResults;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CaptureRequest mRequest;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> mSequenceId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> mFrameNumber;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CaptureResult</span><span class="params">(CameraMetadataNative results, </span></span></span><br><span class="line"><span class="function"><span class="params">        CaptureRequest parent, CaptureResultExtras extras)</span> </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">        mResults = CameraMetadataNative.move(results);</span><br><span class="line">        <span class="keyword">if</span> (mResults.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError(<span class="string">"Results must not be empty"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        setNativeInstance(mResults);</span><br><span class="line">        mRequest = parent;</span><br><span class="line">        mSequenceId = extras.getRequestId();</span><br><span class="line">        mFrameNumber = extras.getFrameNumber();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取键对应的值</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">get</span><span class="params">(Key&lt;T&gt; key)</span> </span>&#123;</span><br><span class="line">        T value = mResults.get(key);</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获取键列表</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Key&lt;?&gt;&gt; getKeys() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getKeys();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获取当前结果的请求 CaptureRequest</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CaptureRequest <span class="title">getRequest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mRequest;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获取当前结果的帧号</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getFrameNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mFrameNumber;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获取序列号；该序列号为 CameraCaptureSession.capture 的返回值</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSequenceId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mSequenceId;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>CaptureResult.Key</code> 和 <code>CaptureRequest.Key</code> 代码几乎一样，主要是提供一个 <code>Key</code> 封装。  </p>
<h2 id="TotalCaptureResult"><a href="#TotalCaptureResult" class="headerlink" title="TotalCaptureResult"></a><code>TotalCaptureResult</code></h2><p><code>TotalCaptureResult</code> 继承了 <code>CaptureResult</code> ；表示传感器捕获的单个图像组成的结果集合。在 <code>CaptureCallback.onCaptureCompleted</code> 回调后，会返回 <code>TotalCaptureResult</code> 总的捕获结果集合。部分源码如下：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">TotalCaptureResult</span> <span class="keyword">extends</span> <span class="title">CaptureResult</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;CaptureResult&gt; mPartialResults;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> mSessionId;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// 获取结果集</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;CaptureResult&gt; <span class="title">getPartialResults</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Collections.unmodifiableList(mPartialResults);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取当前结果集的会话 ID</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSessionId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mSessionId;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="DngCreator"><a href="#DngCreator" class="headerlink" title="DngCreator"></a><code>DngCreator</code></h2><p><code>DngCreator</code> 用于将传感器捕获到的原始图像数据转换为 <code>DNG</code> 格式图片，图片相关处理的方法都是 <code>native</code> 的。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">DngCreator</span> <span class="keyword">implements</span> <span class="title">AutoCloseable</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 缩略图最大尺寸</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_THUMBNAIL_DIMENSION = <span class="number">256</span>;</span><br><span class="line">    <span class="comment">// 根据配置文件 CameraCharacteristics 和捕获结果 CaptureResult </span></span><br><span class="line">    <span class="comment">// 生成 DNG 图片</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DngCreator</span> <span class="params">(CameraCharacteristics characteristics, </span></span></span><br><span class="line"><span class="function"><span class="params">                CaptureResult metadata)</span></span>&#123;...&#125;</span><br><span class="line">                </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span></span>&#123;...&#125;</span><br><span class="line">    <span class="comment">// 设置图片描述</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DngCreator <span class="title">setDescription</span><span class="params">(String description)</span></span>&#123;...&#125;</span><br><span class="line">    <span class="comment">// 设置位置信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DngCreator <span class="title">setLocation</span><span class="params">(Location location)</span></span>&#123;...&#125;</span><br><span class="line">    <span class="comment">// 设置图片旋转方向</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DngCreator <span class="title">setOrientation</span><span class="params">(<span class="keyword">int</span> orientation)</span></span>&#123;...&#125;</span><br><span class="line">    <span class="comment">// 创建缩略图</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DngCreator <span class="title">setThumbnail</span><span class="params">(Image pixels)</span></span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DngCreator <span class="title">setThumbnail</span><span class="params">(Bitmap pixels)</span></span>&#123;...&#125;</span><br><span class="line">    <span class="comment">// 将原始像素中元数据写入 DNG 图片</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeByteBuffer</span> <span class="params">(OutputStream dngOutput, </span></span></span><br><span class="line"><span class="function"><span class="params">        Size size, ByteBuffer pixels, <span class="keyword">long</span> offset)</span></span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeImage</span> <span class="params">(OutputStream dngOutput, Image pixels)</span></span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeInputStream</span> <span class="params">(OutputStream dngOutput, </span></span></span><br><span class="line"><span class="function"><span class="params">        Size size, InputStream pixels, <span class="keyword">long</span> offset)</span></span>&#123;...&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><h3 id="TextureView-输出显示"><a href="#TextureView-输出显示" class="headerlink" title="TextureView 输出显示"></a><code>TextureView</code> 输出显示</h3><p>通过 <code>TextureView</code> 来显示捕获的数据；需要监听 <code>TextureView.SurfaceTextureListener</code> ，当输出 <code>onSurfaceTextureAvailable</code> 可用时，才能向 <code>CameraDevice</code> 请求数据输出。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> TextureView mTextureView;</span><br><span class="line"><span class="keyword">private</span> Surface mTextureSurface;</span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onResume();</span><br><span class="line">    <span class="keyword">if</span> (mTextureView.isAvailable())&#123;</span><br><span class="line">        openCamera();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        mTextureView.setSurfaceTextureListener(mSurfaceTextureListener);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> TextureView.SurfaceTextureListener mSurfaceTextureListener = </span><br><span class="line">    <span class="keyword">new</span> TextureView.SurfaceTextureListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSurfaceTextureAvailable</span><span class="params">(SurfaceTexture surface, </span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">int</span> width, <span class="keyword">int</span> height)</span> </span>&#123;</span><br><span class="line">        openCamera();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSurfaceTextureSizeChanged</span><span class="params">(SurfaceTexture surface, </span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">int</span> width, <span class="keyword">int</span> height)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onSurfaceTextureDestroyed</span><span class="params">(SurfaceTexture surface)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSurfaceTextureUpdated</span><span class="params">(SurfaceTexture surface)</span> </span>&#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="获取-CameraManager"><a href="#获取-CameraManager" class="headerlink" title="获取 CameraManager"></a>获取 <code>CameraManager</code></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mCameraManager = (CameraManager) getSystemService(Context.CAMERA_SERVICE);</span><br></pre></td></tr></table></figure>

<h3 id="获取后置摄像头-ID-及支持级别"><a href="#获取后置摄像头-ID-及支持级别" class="headerlink" title="获取后置摄像头 ID 及支持级别"></a>获取后置摄像头 <code>ID</code> 及支持级别</h3><p>通过 <code>CameraCharacteristics</code> 了解设备的属性。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (String cameraId : mCameraManager.getCameraIdList()) &#123;</span><br><span class="line">    CameraCharacteristics cameraCharacteristics = </span><br><span class="line">        mCameraManager.getCameraCharacteristics(cameraId);</span><br><span class="line">    <span class="comment">// support LEVEL</span></span><br><span class="line">    Integer level = cameraCharacteristics.get(</span><br><span class="line">        CameraCharacteristics.INFO_SUPPORTED_HARDWARE_LEVEL);</span><br><span class="line">    Log.d(TAG, <span class="string">"preview: cameraId = "</span> + cameraId + <span class="string">", level = "</span> + level);</span><br><span class="line">    Integer facing = cameraCharacteristics.get(</span><br><span class="line">        CameraCharacteristics.LENS_FACING);</span><br><span class="line">    <span class="comment">// rear camera</span></span><br><span class="line">    <span class="keyword">if</span> (facing != <span class="keyword">null</span> &amp;&amp; facing==CameraCharacteristics.LENS_FACING_BACK)&#123;</span><br><span class="line">        mCameraId = cameraId;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="打开-CameraDevice-并设置状态监听"><a href="#打开-CameraDevice-并设置状态监听" class="headerlink" title="打开 CameraDevice 并设置状态监听"></a>打开 <code>CameraDevice</code> 并设置状态监听</h3><p>打开 <code>CameraDevice</code> 时设置状态监听；在设备正确打开后，在 <code>CameraDevice.StateCallback.onOpened</code> 中创建 <code>CameraCaptureSession</code> 会话。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">CameraDevice.StateCallback mCameraDeviceStateCallback = </span><br><span class="line">    <span class="keyword">new</span> CameraDevice.StateCallback() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onOpened</span><span class="params">(@NonNull CameraDevice camera)</span> </span>&#123;</span><br><span class="line">        mCameraDevice = camera;</span><br><span class="line">        <span class="comment">// 创建会话</span></span><br><span class="line">        createCameraCaptureSession();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDisconnected</span><span class="params">(@NonNull CameraDevice camera)</span> </span>&#123;</span><br><span class="line">        camera.close();</span><br><span class="line">        mCameraDevice = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(@NonNull CameraDevice camera, <span class="keyword">int</span> error)</span> </span>&#123;</span><br><span class="line">        camera.close();</span><br><span class="line">        mCameraDevice = <span class="keyword">null</span>;</span><br><span class="line">        Log.e(TAG, <span class="string">"onError: error = "</span> + error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    mCameraManager.openCamera(mCameraId, mCameraDeviceStateCallback, </span><br><span class="line">        mBackHandler);</span><br><span class="line">&#125; <span class="keyword">catch</span> (CameraAccessException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="初始化输出-Surface"><a href="#初始化输出-Surface" class="headerlink" title="初始化输出 Surface"></a>初始化输出 <code>Surface</code></h3><p>本示例中有两个 <code>Surface</code> ：  </p>
<ul>
<li><code>TextureView</code> 对应 <code>Surface</code> ：预览时用于实时输出  </li>
<li><code>ImageReader</code> 对应 <code>Surface</code> ：拍照时用于保存图片  </li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">SurfaceTexture texture = mTextureView.getSurfaceTexture();</span><br><span class="line">texture.setDefaultBufferSize(WIDTH, HEIGHT);</span><br><span class="line">mTextureSurface = <span class="keyword">new</span> Surface(texture);</span><br><span class="line"></span><br><span class="line">mImageReader = ImageReader.newInstance(WIDTH, HEIGHT, ImageFormat.JPEG, <span class="number">2</span>);</span><br><span class="line"><span class="comment">// 设置监听事件，当 ImageReader 中可以读取图片时保存文件</span></span><br><span class="line">mImageReader.setOnImageAvailableListener(</span><br><span class="line">    <span class="keyword">new</span> ImageReader.OnImageAvailableListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onImageAvailable</span><span class="params">(ImageReader reader)</span> </span>&#123;</span><br><span class="line">        File file = createImageFile();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != file) &#123;</span><br><span class="line">            mBackHandler.post(<span class="keyword">new</span> ImageSaveRunnable(</span><br><span class="line">                reader.acquireNextImage(), file));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Toast.makeText(CustomCamera2Activity.<span class="keyword">this</span>, </span><br><span class="line">                <span class="string">"create File error!"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, mBackHandler);</span><br></pre></td></tr></table></figure>

<h3 id="创建会话-CameraCaptureSession"><a href="#创建会话-CameraCaptureSession" class="headerlink" title="创建会话  CameraCaptureSession"></a>创建会话  <code>CameraCaptureSession</code></h3><p>通过 <code>mCameraDevice.createCaptureSession</code> 创建会话成功后，在回调方法 <code>CameraCaptureSession.StateCallback.onConfigured</code> 中获取会话 <code>mCameraCaptureSession</code> ，后续所有的 <code>CaptureRequest</code> 都是通过该会话发起。<br>可以在创建会话成功时，同步开启预览请求 <code>preview</code> 。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createCameraCaptureSession</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            mCameraDevice.createCaptureSession(Arrays.asList(</span><br><span class="line">                mTextureSurface, mImageReader.getSurface()),</span><br><span class="line">                <span class="keyword">new</span> CameraCaptureSession.StateCallback() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onConfigured</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">                    @NonNull CameraCaptureSession session)</span> </span>&#123;</span><br><span class="line">                    Log.d(TAG, <span class="string">"onConfigured: "</span>);</span><br><span class="line">                    mCameraCaptureSession = session;</span><br><span class="line">                    <span class="comment">// 开启预览请求</span></span><br><span class="line">                    preview();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onConfigureFailed</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">                    @NonNull CameraCaptureSession session)</span> </span>&#123;</span><br><span class="line">                    Log.e(TAG, <span class="string">"onConfigureFailed: "</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (CameraAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="发出预览请求-CaptureRequest"><a href="#发出预览请求-CaptureRequest" class="headerlink" title="发出预览请求 CaptureRequest"></a>发出预览请求 <code>CaptureRequest</code></h3><p>预览请求为 <code>CameraDevice.TEMPLATE_PREVIEW</code> ，设置输出为 <code>mTextureSurface</code> ，当捕获到预览数据时，会反复响应 <code>CameraCaptureSession.CaptureCallback</code> ：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">preview</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        CaptureRequest.Builder previewRequestBuilder = </span><br><span class="line">          mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_PREVIEW);</span><br><span class="line">        previewRequestBuilder.addTarget(mTextureSurface);</span><br><span class="line">        CameraCaptureSession.CaptureCallback captureCallback = </span><br><span class="line">            <span class="keyword">new</span> CameraCaptureSession.CaptureCallback() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCaptureCompleted</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">                @NonNull CameraCaptureSession session, </span></span></span><br><span class="line"><span class="function"><span class="params">                @NonNull CaptureRequest request, </span></span></span><br><span class="line"><span class="function"><span class="params">                @NonNull TotalCaptureResult result)</span> </span>&#123;</span><br><span class="line">                <span class="comment">//Log.d(TAG, "preview, onCaptureCompleted: ");</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        mCameraCaptureSession.setRepeatingRequest(</span><br><span class="line">            previewRequestBuilder.build(), captureCallback, mBackHandler);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (CameraAccessException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="发出拍照请求-CaptureRequest"><a href="#发出拍照请求-CaptureRequest" class="headerlink" title="发出拍照请求 CaptureRequest"></a>发出拍照请求 <code>CaptureRequest</code></h3><p>拍照请求为 <code>CameraDevice.TEMPLATE_STILL_CAPTURE</code> ，设置输出为 <code>mImageReader.getSurface()</code> ，当存在有效数据时直接触发 <code>ImageReader.OnImageAvailableListener</code> 。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">takePicture</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//mPreviewRequestBuilder.set(CaptureRequest.CONTROL_AF_TRIGGER,</span></span><br><span class="line">    <span class="comment">//CameraMetadata.CONTROL_AF_TRIGGER_START);</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        CaptureRequest.Builder captureRequestBuild = mCameraDevice</span><br><span class="line">            .createCaptureRequest(CameraDevice.TEMPLATE_STILL_CAPTURE);</span><br><span class="line">        captureRequestBuild.addTarget(mImageReader.getSurface());</span><br><span class="line">        captureRequestBuild.set(CaptureRequest.CONTROL_AF_MODE, </span><br><span class="line">            CaptureRequest.CONTROL_AF_MODE_CONTINUOUS_PICTURE);</span><br><span class="line">        <span class="comment">// 配置图片方向</span></span><br><span class="line">        captureRequestBuild.set(CaptureRequest.JPEG_ORIENTATION, </span><br><span class="line">            mImageOrientation);</span><br><span class="line">        CameraCaptureSession.CaptureCallback captureCallback = </span><br><span class="line">            <span class="keyword">new</span> CameraCaptureSession.CaptureCallback() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCaptureCompleted</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">                @NonNull CameraCaptureSession session, </span></span></span><br><span class="line"><span class="function"><span class="params">                @NonNull CaptureRequest request, </span></span></span><br><span class="line"><span class="function"><span class="params">                @NonNull TotalCaptureResult result)</span> </span>&#123;</span><br><span class="line">                Log.d(TAG, <span class="string">"takePicture, onCaptureCompleted: "</span>);</span><br><span class="line">                Toast.makeText(CustomCamera2Activity.<span class="keyword">this</span>, </span><br><span class="line">                    <span class="string">"Take Picture, OK!"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        mCameraCaptureSession.stopRepeating();</span><br><span class="line">        mCameraCaptureSession.abortCaptures();</span><br><span class="line">        mCameraCaptureSession.capture(captureRequestBuild.build(), </span><br><span class="line">            captureCallback, mBackHandler);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (CameraAccessException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里需要注意的是，拍照前需要根据传感器安装的方向和屏幕旋转角度来配置图片保存方向，否则可能会出现横竖混淆的照片：  </p>
<p><img src="https://raw.githubusercontent.com/redspider110/blog-images/master/_images/0109-android-camera-3-api-camera-pic-ratation.png" alt="0109-android-camera-3-api-camera-pic-ratation.png"></p>
<ul>
<li><p>获取 <code>Camera sensor</code> 安装方向  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mSensorOrientation = </span><br><span class="line">    characteristics.get(CameraCharacteristics.SENSOR_ORIENTATION);</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取当前屏幕的旋转角度  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int displayRotation = activity.getWindowManager()</span><br><span class="line">    .getDefaultDisplay().getRotation();</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>如果安装方向和旋转角度一致（比如都是 <code>90°</code> ），则不需要补偿；否则需要按照<strong>顺时针</strong>方向设置旋转（即屏幕顺时针朝着 <code>sensor</code> 方向旋转角度），参考 <code>Camera.java</code> 中 <code>setDisplayOrientation</code> 方法的代码注释，计算公式如下：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取当前摄像头是前置还是后置</span></span><br><span class="line">Integer facing = </span><br><span class="line">    cameraCharacteristics.get(CameraCharacteristics.LENS_FACING);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取当前 sensor 安装方向</span></span><br><span class="line">Integer mSensorOrientation = </span><br><span class="line">    characteristics.get(CameraCharacteristics.SENSOR_ORIENTATION);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取当前屏幕旋转</span></span><br><span class="line"><span class="keyword">int</span> rotation = activity.getWindowManager()</span><br><span class="line">    .getDefaultDisplay().getRotation();</span><br><span class="line"><span class="comment">// 将旋转转换成角度</span></span><br><span class="line"><span class="keyword">int</span> degrees = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">switch</span> (rotation) &#123;</span><br><span class="line">    <span class="keyword">case</span> Surface.ROTATION_0: degrees = <span class="number">0</span>; <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> Surface.ROTATION_90: degrees = <span class="number">90</span>; <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> Surface.ROTATION_180: degrees = <span class="number">180</span>; <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> Surface.ROTATION_270: degrees = <span class="number">270</span>; <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//int result;</span></span><br><span class="line"><span class="comment">// 前后摄计算公式不一样</span></span><br><span class="line"><span class="keyword">if</span> (facing == CameraCharacteristics.LENS_FACING_FRONT) &#123;</span><br><span class="line">    mImageOrientation = (mSensorOrientation + degrees) % <span class="number">360</span>;</span><br><span class="line">    <span class="comment">// compensate the mirror</span></span><br><span class="line">    mImageOrientation = (<span class="number">360</span> - mImageOrientation) % <span class="number">360</span>;  </span><br><span class="line">&#125; <span class="keyword">else</span> &#123;  <span class="comment">// back-facing</span></span><br><span class="line">    mImageOrientation = (mSensorOrientation - degrees + <span class="number">360</span>) % <span class="number">360</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们以后摄为例，屏幕旋转方向和 <code>Camera sensor</code> 安装方向可能出现的如下几种组合：  </p>
<p><img src="https://raw.githubusercontent.com/redspider110/blog-images/master/_images/0109-android-camera-3-api-camera-orientation.png" alt="0109-android-camera-3-api-camera-orientation.png"></p>
<p>补偿角度的计算结果按照公式如下，先以 <code>Sensor</code> 方向不变：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0:  (0  - 0   + 360) % 360  = 0     180: (180 - 0   + 360) % 360 = 180</span><br><span class="line">0:  (0  - 90  + 360) % 360  = 270   180: (180 - 90  + 360) % 360 = 90</span><br><span class="line">0:  (0  - 180 + 360) % 360  = 180   180: (180 - 180 + 360) % 360 = 0</span><br><span class="line">0:  (0  - 270 + 360) % 360  = 90    180: (180 - 270 + 360) % 360 = 270</span><br><span class="line">                              </span><br><span class="line">90: (90 - 0   + 360) % 360 = 90     270: (270 - 0   + 360) % 360 = 270</span><br><span class="line">90: (90 - 90  + 360) % 360 = 0      270: (270 - 90  + 360) % 360 = 180</span><br><span class="line">90: (90 - 180 + 360) % 360 = 270    270: (270 - 180 + 360) % 360 = 90</span><br><span class="line">90: (90 - 270 + 360) % 360 = 180    270: (270 - 270 + 360) % 360 = 0</span><br></pre></td></tr></table></figure>

<p>当 <code>Sensor</code> 安装方向为 0 时，如果屏幕旋转角度也为 0 ，则两个是同方向的，不需要补偿（补偿为 0）；当 <code>Sensor</code> 安装方向为 <code>180</code> 时，如果屏幕旋转角度为 90 （向右横屏），则需要补偿 90 （即当前屏幕方向朝 <code>Sensor</code> 方向旋转 90 度）。  </p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><ul>
<li>需要等待 <code>TextureView</code> 可用后，才能开启预览  </li>
<li>图片保存时，需要设置方向，否则可能会出现旋转角度  </li>
</ul>
<h3 id="序列图"><a href="#序列图" class="headerlink" title="序列图"></a>序列图</h3><p><img src="https://raw.githubusercontent.com/redspider110/blog-images/master/_images/0109-android-camera-3-api-class-flow.png" alt="0109-android-camera-3-api-class-flow.png"></p>
<h2 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h2><h3 id="CameraMetadata-及其子类的-Key-值"><a href="#CameraMetadata-及其子类的-Key-值" class="headerlink" title="CameraMetadata 及其子类的 Key 值"></a><code>CameraMetadata</code> 及其子类的 <code>Key</code> 值</h3><p><code>CameraMetadata, CaptureRequest, CaptureResult, CameraCharacteristics</code> 的几个常量都是 <code>system/media/camera/docs</code> 中脚本自动生成的，在 <code>metadata_properties.xml</code> 中定义，解析时的对应关系为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">## Static properties only</span><br><span class="line">##$&#123;single_kind_keys(&apos;CameraCharacteristicsKeys&apos;, &apos;static&apos;)&#125;</span><br><span class="line">##</span><br><span class="line">## Controls properties only</span><br><span class="line">##$&#123;single_kind_keys(&apos;CaptureRequestKeys&apos;, &apos;controls&apos;)&#125;</span><br><span class="line">##</span><br><span class="line">## Dynamic properties only</span><br><span class="line">##$&#123;single_kind_keys(&apos;CaptureResultKeys&apos;, &apos;dynamic&apos;)&#125;</span><br></pre></td></tr></table></figure>

<h3 id="CameraCaptureSession-的两个重要方法"><a href="#CameraCaptureSession-的两个重要方法" class="headerlink" title="CameraCaptureSession 的两个重要方法"></a><code>CameraCaptureSession</code> 的两个重要方法</h3><ul>
<li><code>setRepeatingRequest</code> ：用于预览   </li>
<li><code>capture</code> ：用于拍照  </li>
</ul>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a href="https://developer.android.com/training/camera/" target="_blank" rel="noopener">Android training camera</a>  </li>
<li><a href="https://developer.android.com/reference/android/hardware/camera2/package-summary" target="_blank" rel="noopener">Android Camera2 API Summary</a>  </li>
<li><a href="https://source.android.com/devices/camera" target="_blank" rel="noopener">Android Camera developer</a>  </li>
<li><a href="https://github.com/googlesamples/android-Camera2Basic" target="_blank" rel="noopener">GoogleSamples: Camera2Basic</a>  </li>
<li><a href="https://www.jianshu.com/p/4e838a5cdb05" target="_blank" rel="noopener">Camera API和HAL版本对应关系:Hal 1,3的区别</a>  </li>
<li><a href="https://www.jianshu.com/p/23e8789fbc10" target="_blank" rel="noopener">Camera2 基本结构及流程</a>  </li>
<li><a href="https://blog.csdn.net/huajun998/article/details/80367610" target="_blank" rel="noopener">Camera2 API 学习笔记</a>  </li>
<li><a href="https://www.jianshu.com/p/2d3ee80198e7" target="_blank" rel="noopener">Android照相机基础基于camera2API</a>  </li>
<li><a href="https://blog.csdn.net/qidanchederizi/article/details/79405062" target="_blank" rel="noopener">Camera2 拍照横屏问题</a>  </li>
<li><a href="https://www.polarxiong.com/archives/Android%E7%9B%B8%E6%9C%BA%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97.html" target="_blank" rel="noopener">Camera2 自定义实现相机</a>  </li>
<li><a href="https://blog.csdn.net/hejjunlin/article/details/52751055" target="_blank" rel="noopener">Camera框架之Camera2补充</a>  </li>
<li><a href="https://www.jianshu.com/p/c362c6de0e23" target="_blank" rel="noopener">Android开发中关于摄像头方向的理解</a>  </li>
<li><a href="https://wenku.baidu.com/view/5d308b1458fafab069dc02ad.html" target="_blank" rel="noopener">camera摄像头成像方向与LCD屏预览关系</a>  </li>
</ul>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    redspider110
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://redspider110.github.io/2018/11/28/0109-android-camera-3-api2/" title="Android Camera API2 介绍">http://redspider110.github.io/2018/11/28/0109-android-camera-3-api2/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Android/" rel="tag"># Android</a>
          
            <a href="/tags/Camera/" rel="tag"># Camera</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/11/26/0109-android-camera-2-basic/" rel="next" title="Camera 相关名词等">
                <i class="fa fa-chevron-left"></i> Camera 相关名词等
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/12/06/0109-android-camera-4-framework/" rel="prev" title="Camera Framework 分析">
                Camera Framework 分析 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.png" alt="redspider110">
            
              <p class="site-author-name" itemprop="name">redspider110</p>
              <p class="site-description motion-element" itemprop="description">地球卫士</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">124</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">54</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          
            <div class="cc-license motion-element" itemprop="license">
              <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" target="_blank">
                <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons">
              </a>
            </div>
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#基础"><span class="nav-number">1.</span> <span class="nav-text">基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#camera-各个版本"><span class="nav-number">1.1.</span> <span class="nav-text">camera 各个版本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Camera-API1"><span class="nav-number">1.2.</span> <span class="nav-text">Camera API1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Camera-API2"><span class="nav-number">1.3.</span> <span class="nav-text">Camera API2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HAL-新旧版本架构图"><span class="nav-number">1.4.</span> <span class="nav-text">HAL 新旧版本架构图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Camera2-类图结构"><span class="nav-number">2.</span> <span class="nav-text">Camera2 类图结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#各个类功能简介"><span class="nav-number">2.1.</span> <span class="nav-text">各个类功能简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#基本结构"><span class="nav-number">2.2.</span> <span class="nav-text">基本结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#简化使用流程图"><span class="nav-number">2.3.</span> <span class="nav-text">简化使用流程图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CameraManager"><span class="nav-number">3.</span> <span class="nav-text">CameraManager</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#API-方法"><span class="nav-number">3.1.</span> <span class="nav-text">API 方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AvailabilityCallback-回调"><span class="nav-number">3.2.</span> <span class="nav-text">AvailabilityCallback 回调</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TorchCallback-回调"><span class="nav-number">3.3.</span> <span class="nav-text">TorchCallback 回调</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CameraDevice"><span class="nav-number">4.</span> <span class="nav-text">CameraDevice</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#常量"><span class="nav-number">4.1.</span> <span class="nav-text">常量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#API-方法-1"><span class="nav-number">4.2.</span> <span class="nav-text">API 方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#StateCallback-回调"><span class="nav-number">4.3.</span> <span class="nav-text">StateCallback 回调</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CameraCaptureSession"><span class="nav-number">5.</span> <span class="nav-text">CameraCaptureSession</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#API-方法-2"><span class="nav-number">5.1.</span> <span class="nav-text">API 方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#StateCallback-回调-1"><span class="nav-number">5.1.1.</span> <span class="nav-text">StateCallback 回调</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CaptureCallback-回调"><span class="nav-number">5.2.</span> <span class="nav-text">CaptureCallback 回调</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CameraConstrainedHighSpeedCaptureSession"><span class="nav-number">6.</span> <span class="nav-text">CameraConstrainedHighSpeedCaptureSession</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CaptureFailure"><span class="nav-number">7.</span> <span class="nav-text">CaptureFailure</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#常量-1"><span class="nav-number">7.1.</span> <span class="nav-text">常量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#API-方法-3"><span class="nav-number">7.2.</span> <span class="nav-text">API 方法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CameraMetadata"><span class="nav-number">8.</span> <span class="nav-text">CameraMetadata</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#常量-2"><span class="nav-number">8.1.</span> <span class="nav-text">常量</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CameraCharacteristics"><span class="nav-number">9.</span> <span class="nav-text">CameraCharacteristics</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Key-常量"><span class="nav-number">9.1.</span> <span class="nav-text">Key 常量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#API-方法-4"><span class="nav-number">9.2.</span> <span class="nav-text">API 方法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CaptureRequest"><span class="nav-number">10.</span> <span class="nav-text">CaptureRequest</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Key-常量-1"><span class="nav-number">10.1.</span> <span class="nav-text">Key 常量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#API-方法-5"><span class="nav-number">10.2.</span> <span class="nav-text">API 方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Builder-内部类"><span class="nav-number">10.3.</span> <span class="nav-text">Builder 内部类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Key-内部类"><span class="nav-number">10.4.</span> <span class="nav-text">Key 内部类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CaptureResult"><span class="nav-number">11.</span> <span class="nav-text">CaptureResult</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Key-常量-2"><span class="nav-number">11.1.</span> <span class="nav-text">Key 常量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#API-方法-6"><span class="nav-number">11.2.</span> <span class="nav-text">API 方法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TotalCaptureResult"><span class="nav-number">12.</span> <span class="nav-text">TotalCaptureResult</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DngCreator"><span class="nav-number">13.</span> <span class="nav-text">DngCreator</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#示例"><span class="nav-number">14.</span> <span class="nav-text">示例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#TextureView-输出显示"><span class="nav-number">14.1.</span> <span class="nav-text">TextureView 输出显示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取-CameraManager"><span class="nav-number">14.2.</span> <span class="nav-text">获取 CameraManager</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取后置摄像头-ID-及支持级别"><span class="nav-number">14.3.</span> <span class="nav-text">获取后置摄像头 ID 及支持级别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#打开-CameraDevice-并设置状态监听"><span class="nav-number">14.4.</span> <span class="nav-text">打开 CameraDevice 并设置状态监听</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#初始化输出-Surface"><span class="nav-number">14.5.</span> <span class="nav-text">初始化输出 Surface</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建会话-CameraCaptureSession"><span class="nav-number">14.6.</span> <span class="nav-text">创建会话  CameraCaptureSession</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#发出预览请求-CaptureRequest"><span class="nav-number">14.7.</span> <span class="nav-text">发出预览请求 CaptureRequest</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#发出拍照请求-CaptureRequest"><span class="nav-number">14.8.</span> <span class="nav-text">发出拍照请求 CaptureRequest</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#小结"><span class="nav-number">14.9.</span> <span class="nav-text">小结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#序列图"><span class="nav-number">14.10.</span> <span class="nav-text">序列图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#小结-1"><span class="nav-number">15.</span> <span class="nav-text">小结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CameraMetadata-及其子类的-Key-值"><span class="nav-number">15.1.</span> <span class="nav-text">CameraMetadata 及其子类的 Key 值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CameraCaptureSession-的两个重要方法"><span class="nav-number">15.2.</span> <span class="nav-text">CameraCaptureSession 的两个重要方法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考文档"><span class="nav-number">16.</span> <span class="nav-text">参考文档</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">redspider110</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.3</div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  

  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  








  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
